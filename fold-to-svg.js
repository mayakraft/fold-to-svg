!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(n="undefined"!=typeof globalThis?globalThis:n||self).FoldToSvg=r()}(this,(function(){"use strict";function n(n,r){for(var e=n.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),t=e.length,u=!1,o=0,i="",c=null!=r&&"string"==typeof r?r:"\t",l=["\n"],a=0;a<100;a+=1)l.push(l[a]+c);for(var f=0;f<t;f+=1)e[f].search(/<!/)>-1?(i+=l[o]+e[f],u=!0,(e[f].search(/-->/)>-1||e[f].search(/\]>/)>-1||e[f].search(/!DOCTYPE/)>-1)&&(u=!1)):e[f].search(/-->/)>-1||e[f].search(/\]>/)>-1?(i+=e[f],u=!1):/^<\w/.exec(e[f-1])&&/^<\/\w/.exec(e[f])&&/^<[\w:\-\.\,]+/.exec(e[f-1])==/^<\/[\w:\-\.\,]+/.exec(e[f])[0].replace("/","")?(i+=e[f],u||(o-=1)):e[f].search(/<\w/)>-1&&-1===e[f].search(/<\//)&&-1===e[f].search(/\/>/)?i=i+=u?e[f]:l[o++]+e[f]:e[f].search(/<\w/)>-1&&e[f].search(/<\//)>-1?i=i+=u?e[f]:l[o]+e[f]:e[f].search(/<\//)>-1?i=i+=u?e[f]:l[--o]+e[f]:e[f].search(/\/>/)>-1?i=i+=u?e[f]:l[o]+e[f]:e[f].search(/<\?/)>-1||e[f].search(/xmlns\:/)>-1||e[f].search(/xmlns\=/)>-1?i+=l[o]+e[f]:i+=e[f];return"\n"===i[0]?i.slice(1):i}var r="vertices",e="edges",t="faces",u="boundaries",o="boundary",i="mountain",c="valley",l="mark",a="unassigned",f="front",s="back",d="svg",h="class",p="index",m="object",v="string",y="undefined",g="black",b="white",S="lightgray",w="stroke-width",j="createElementNS",N="setAttributeNS",_="appendChild",k="vertices_coords",E="edges_vertices",O="faces_vertices",x="faces_edges",G="edges_assignment",V="faces_re:layer",A="frame_classes",M="file_classes";function T(n){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function z(n,r){return function(n){if(Array.isArray(n))return n}(n)||function(n,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(n)))return;var e=[],t=!0,u=!1,o=void 0;try{for(var i,c=n[Symbol.iterator]();!(t=(i=c.next()).done)&&(e.push(i.value),!r||e.length!==r);t=!0);}catch(n){u=!0,o=n}finally{try{t||null==c["return"]||c["return"]()}finally{if(u)throw o}}return e}(n,r)||D(n,r)||function(){throw new TypeError("Invalid non-iterable destructure.")}()}function C(n){return function(n){if(Array.isArray(n))return F(n)}(n)||function(n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||D(n)||function(){throw new TypeError("Invalid non-iterable spread.")}()}function D(n,r){if(n){if("string"==typeof n)return F(n,r);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?F(n,r):void 0}}function F(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=new Array(r);e<r;e++)t[e]=n[e];return t}var P=("undefined"==typeof window?"undefined":T(window))!==y&&T(window.document)!==y,B=("undefined"==typeof process?"undefined":T(process))!==y&&null!=process.versions&&null!=process.versions.node,I=(("undefined"==typeof self?"undefined":T(self))===m&&self.constructor&&self.constructor.name,function(){var n={};if(B){var r=require("xmldom"),e=r.DOMParser,t=r.XMLSerializer;n.DOMParser=e,n.XMLSerializer=t,n.document=(new e).parseFromString("<!DOCTYPE html><title>.</title>","text/html")}else P&&(n=window);return n}()),L="http://www.w3.org/2000/svg",U={SVG:{NS:L,g:function(){return I.document[j](L,"g")},defs:function(){return I.document[j](L,"defs")},style:function(){var n=I.document[j](L,"style");return n[N](null,"type","text/css"),n},line:function(n,r,e,t){var u=I.document[j](L,"line");return u[N](null,"x1",n),u[N](null,"y1",r),u[N](null,"x2",e),u[N](null,"y2",t),u},circle:function(n,r,e){var t=I.document[j](L,"circle");return t[N](null,"cx",n),t[N](null,"cy",r),t[N](null,"r",e),t},polygon:function(n){var r=I.document[j](L,"polygon"),e=n.map((function(n){return"".concat(n[0],",").concat(n[1])})).join(" ");return r[N](null,"points",e),r},path:function(n){var r=I.document[j](L,"path");return r[N](null,"d",n),r}}},X=function n(r){return Object.freeze(r),void 0===r||Object.getOwnPropertyNames(r).filter((function(n){return null!==r[n]&&(T(r[n])===m||"function"===T(r[n]))&&!Object.isFrozen(r[n])})).forEach((function(e){return n(r[e])})),r},Y=function n(r,e){return Object.keys(e).forEach((function(t){T(e[t])===m&&null!==e[t]?(t in r||(r[t]={}),n(r[t],e[t])):T(r)!==m||t in r||(r[t]=e[t])})),r},q=function(n){if(null==n)return{};if(T(n)===m&&null!==n)return n;if(T(n)===v||n instanceof String)try{return JSON.parse(n)}catch(n){return{}}return{}},J=function(n){if(null==n[k]||n[k].length<=0)return[0,0,0,0];var r=n[k][0].length,e=Array(r).fill(1/0),t=Array(r).fill(-1/0);return n[k].forEach((function(n){return n.forEach((function(n,r){n<e[r]&&(e[r]=n),n>t[r]&&(t[r]=n)}))})),isNaN(e[0])||isNaN(e[1])||isNaN(t[0])||isNaN(t[1])?[0,0,0,0]:[e[0],e[1],t[0]-e[0],t[1]-e[1]]},$=function(n){if(null==n[G])return{vertices:[],edges:[]};for(var r=n[G].map((function(n){return"B"===n||"b"===n})),e=function(n){if(n[E]){var r=[];return n[E].forEach((function(n,e){return n.forEach((function(n){void 0===r[n]&&(r[n]=[]),r[n].push(e)}))})),r}}(n),t=[],u=[],o=-1,i=0;i<r.length;i+=1)if(r[i]){o=i;break}if(-1===o)return{vertices:[],edges:[]};r[o]=!1,t.push(o),u.push(n[E][o][0]);for(var c=n[E][o][1];u[0]!==c;){if(u.push(c),void 0===(o=e[c].filter((function(n){return r[n]})).shift()))return{vertices:[],edges:[]};if(n[E][o][0]===c)c=z(n[E][o],2)[1];else c=z(n[E][o],1)[0];r[o]=!1,t.push(o)}return{vertices:u,edges:t}},H="none",K="500px",Q=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return X({input:v,output:v,padding:null,file_frame:null,stylesheet:null,shadows:null,boundaries:!0,faces:!0,edges:!0,vertices:!1,attributes:{svg:{width:K,height:K,stroke:g,fill:H,"stroke-linejoin":"bevel","stroke-width":n/200},circle:{r:n/200},boundaries:{fill:b},faces:{stroke:H,front:{stroke:g,fill:S},back:{stroke:g,fill:b}},edges:{boundary:{},mountain:{stroke:"red"},valley:{stroke:"blue"},mark:{stroke:S},unassigned:{stroke:S}},vertices:{stroke:H,fill:g}}})},R=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=J(n),t=Math.min(e[2],e[3]);return Y(r,Q(t)),r.shadows&&Y(r,{attributes:{faces:{front:{filter:"url(#shadow)"},back:{filter:"url(#shadow)"}}}}),r},W=function(n){if(k in n==!1||E in n==!1||G in n==!1)return[];var r=$(n).vertices.map((function(r){return[0,1].map((function(e){return n[k][r][e]}))}));if(0===r.length)return[];var e=U.SVG.polygon(r);return e[N](null,h,o),[e]},Z=function(n,r){if(k in n==!1)return[];var e=n[k].map((function(n){return U.SVG.circle(n[0],n[1],.01)}));return e.forEach((function(n,r){return n[N](null,p,r)})),e},nn={B:o,b:o,M:i,m:i,V:c,v:c,F:l,f:l,U:a,u:a},rn={B:"b",b:"b",M:"m",m:"m",V:"v",v:"v",F:"f",f:"f",U:"u",u:"u"},en=function(n){return null==n[E]||null==n[k]?[]:n[E].map((function(r){return r.map((function(r){return n[k][r]}))}))},tn=function(n){return"M".concat(n[0][0]," ").concat(n[0][1],"L").concat(n[1][0]," ").concat(n[1][1])},un=function(n){var r=en(n).map((function(n){return tn(n)})).join("");return""===r?void 0:r},on=function(n){if(null==n[E]||null==n[k]||null==n[G])return[];var r=en(n),e=function(n){var r={u:[],f:[],v:[],m:[],b:[]};return n[G].map((function(n){return rn[n]})).forEach((function(n,e){return r[n].push(e)})),r}(n),t=Object.keys(e).map((function(n){return e[n].map((function(n){return r[n]}))})).map((function(n){return n.map((function(n){return tn(n)})).join("")})),u={};return Object.keys(e).map((function(n,r){""!==t[r]&&(u[n]=t[r])})),u},cn=function(n){if(null==n[G]){var r=un(n);return void 0===r?[]:[U.SVG.path(r)]}var e=on(n);return Object.keys(e).map((function(n){var r=U.SVG.path(e[n]);return r[N](null,h,nn[n]),r}))},ln={subtract:function(n,r){return n.map((function(n,e){return n-(r[e]||0)}))},cross2:function(n,r){return n[0]*r[1]-n[1]*r[0]}},an=function(n,r){T(n.frame_classes)===m&&null!==n.frame_classes&&n.frame_classes.includes("creasePattern");var e,t=null!=n[V]&&n[V].length===n[O].length;return function(n){return n.faces_vertices.map((function(r){return r.map((function(r){return n.vertices_coords[r]})).map((function(n,r,e){return[n,e[(r+1)%e.length],e[(r+2)%e.length]]})).map((function(n){return ln.cross2(ln.subtract(n[1],n[0]),ln.subtract(n[2],n[1]))})).reduce((function(n,r){return n+r}),0)}))}(n).map((function(n){return n<0?f:s})).forEach((function(n,e){return r[e][N](null,h,n)})),t?(e=n[V],e.map((function(n,r){return{layer:n,i:r}})).sort((function(n,r){return n.layer-r.layer})).map((function(n){return n.i}))).map((function(n){return r[n]})):r},fn=function(n){if(O in n==!1||k in n==!1)return[];var r=n[O].map((function(r){return r.map((function(r){return[0,1].map((function(e){return n[k][r][e]}))}))})).map((function(n){return U.SVG.polygon(n)}));return r.forEach((function(n,r){return n[N](null,p,r)})),an(n,r)},sn=function(n){if(x in n==!1||E in n==!1||k in n==!1)return[];var r=n[x].map((function(r){return r.map((function(r){return n[E][r]})).map((function(n,r,e){var t=e[(r+1)%e.length];return n[1]===t[0]||n[1]===t[1]?n[0]:n[1]})).map((function(r){return[0,1].map((function(e){return n[k][r][e]}))}))})).map((function(n){return U.SVG.polygon(n)}));return r.forEach((function(n,r){return n[N](null,p,r)})),an(n,r)},dn={vertices:[],edges:[a,l,c,i,o],faces:[f,s],boundaries:[]},hn=function(n,r,e){var t=r.attributes,u=dn[e]||[];Array.from(n.childNodes).filter((function(n){return t[n.nodeName]})).forEach((function(n){return Object.keys(t[n.nodeName]).forEach((function(r){return n[N](null,r,t[n.nodeName][r])}))})),Object.keys(t[e]).filter((function(n){return!u.includes(n)})).forEach((function(r){return n[N](null,r,t[e][r])})),0!==u.length&&Array.from(n.childNodes).forEach((function(n){return Object.keys(t[e][n.getAttribute(h)]||{}).forEach((function(r){return n[N](null,r,t[e][n.getAttribute(h)][r])}))}))},pn={vertices:Z,edges:cn,faces:function(n){return null!=n[O]?fn(n):sn(n)},boundaries:W},mn=function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.attributes||(o.attributes={}),[u,t,e,r].filter((function(n){return!0===o[n]})).map((function(r){var e=U.SVG.g();return e[N](null,h,r),pn[r](n,o).forEach((function(n){return e[_](n)})),hn(e,o,r),e})).filter((function(n){return n.childNodes.length>0}))},vn=I.document,yn=Object.freeze({blur:.005,opacity:.3,color:g}),gn="result",bn="in",Sn="blur",wn="offsetColor",jn="offsetBlur",Nn="feMergeNode",_n="200%",kn=function(n,r){var e=J(n),t=Math.min(e[2],e[3]),u=U.SVG.defs();if(null!=r.stylesheet){var o=U.SVG.style();u[_](o);var i=r.attributes.svg[w]?r.attributes.svg[w]:t/200,c=(new I.DOMParser).parseFromString("<xml></xml>","application/xml").createCDATASection("\n* { --".concat(w,": ").concat(i,"; }\n").concat(r.stylesheet));o[_](c)}if(null!=r.shadows){var l=T(r.shadows)===m&&null!==r.shadows?r.shadows:{blur:t/200};u[_](function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yn,r="shadow";T(n)===m&&null!==n||(n={}),Object.keys(yn).filter((function(r){return!(r in n)})).forEach((function(r){n[r]=yn[r]}));var e=vn[j](U.SVG.NS,"filter");e[N](null,"width",_n),e[N](null,"height",_n),e[N](null,"id",r);var t=vn[j](U.SVG.NS,"feGaussianBlur");t[N](null,bn,"SourceAlpha"),t[N](null,"stdDeviation",n.blur),t[N](null,gn,Sn);var u=vn[j](U.SVG.NS,"feOffset");u[N](null,bn,Sn),u[N](null,gn,jn);var o=vn[j](U.SVG.NS,"feFlood");o[N](null,"flood-color",n.color),o[N](null,"flood-opacity",n.opacity),o[N](null,gn,wn);var i=vn[j](U.SVG.NS,"feComposite");i[N](null,bn,wn),i[N](null,"in2",jn),i[N](null,"operator",bn),i[N](null,gn,jn);var c=vn[j](U.SVG.NS,"feMerge"),l=vn[j](U.SVG.NS,Nn),a=vn[j](U.SVG.NS,Nn);return a[N](null,bn,"SourceGraphic"),c[_](l),c[_](a),e[_](t),e[_](u),e[_](o),e[_](i),e[_](c),e}(l))}return null!=r.stylesheet||null!=r.shadows?u:void 0},En=function(n,r,e,t){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=1,i=e/o-e,c=n-i-u,l=r-i-u,a=e+2*i+2*u,f=t+2*i+2*u;return[c,l,a,f].join(" ")},On=function(n,r){var e=J(n),t=(Math.min(e[2],e[3]),{viewBox:En.apply(void 0,C(e).concat([r.padding]))}),u=function(n){return[(null!=n[M]?n[M]:[]).join(" "),(null!=n[A]?n[A]:[]).join(" ")].filter((function(n){return""!==n})).join(" ")}(n);return""!==u&&(t[h]=u),Object.assign(t,r.attributes.svg),t},xn=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};R(r,e);var t=kn(r,e);t&&n[_](t),mn(r,e).forEach((function(r){return n[_](r)}));var u=On(r,e);return Object.keys(u).forEach((function(r){return n[N](null,r,u[r])})),n},Gn=function(){var n=I.document[j](U.SVG.NS,d);return n.setAttribute("version","1.1"),n.setAttribute("xmlns",U.SVG.NS),n},Vn=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=q(r);R(t,e);var u=xn(Gn(),t,e);if(e.output===d)return u;var o=(new I.XMLSerializer).serializeToString(u),i=n(o);return i};return Object.assign(Vn,{render_into_svg:xn,render_components:mn,options:R,boundaries_polygon:W,vertices_circle:Z,edges_path_data:un,edges_by_assignment_paths_data:on,edges_path:cn,edges_line:function(n){var r=en(n).map((function(n){return U.SVG.line(n[0][0],n[0][1],n[1][0],n[1][1])}));return r.forEach((function(n,r){return n[N](null,p,r)})),function(n){return null==n[E]||null==n[G]||n[E].length!==n[G].length?[]:n[G].map((function(n){return nn[n]}))}(n).forEach((function(n,e){return r[e][N](null,h,n)})),r},faces_vertices_polygon:fn,faces_edges_polygon:sn,linker:function(n){}.bind(Vn),use:function(n){n.NS&&(U.SVG=n)}}),Vn}));
