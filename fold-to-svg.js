!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(n="undefined"!=typeof globalThis?globalThis:n||self).FoldToSvg=r()}(this,(function(){"use strict";function n(n,r){for(var e=n.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),t=e.length,u=!1,o=0,i="",c=null!=r&&"string"==typeof r?r:"\t",a=["\n"],l=0;l<100;l+=1)a.push(a[l]+c);for(var f=0;f<t;f+=1)e[f].search(/<!/)>-1?(i+=a[o]+e[f],u=!0,(e[f].search(/-->/)>-1||e[f].search(/\]>/)>-1||e[f].search(/!DOCTYPE/)>-1)&&(u=!1)):e[f].search(/-->/)>-1||e[f].search(/\]>/)>-1?(i+=e[f],u=!1):/^<\w/.exec(e[f-1])&&/^<\/\w/.exec(e[f])&&/^<[\w:\-\.\,]+/.exec(e[f-1])==/^<\/[\w:\-\.\,]+/.exec(e[f])[0].replace("/","")?(i+=e[f],u||(o-=1)):e[f].search(/<\w/)>-1&&-1===e[f].search(/<\//)&&-1===e[f].search(/\/>/)?i=i+=u?e[f]:a[o++]+e[f]:e[f].search(/<\w/)>-1&&e[f].search(/<\//)>-1?i=i+=u?e[f]:a[o]+e[f]:e[f].search(/<\//)>-1?i=i+=u?e[f]:a[--o]+e[f]:e[f].search(/\/>/)>-1?i=i+=u?e[f]:a[o]+e[f]:e[f].search(/<\?/)>-1||e[f].search(/xmlns\:/)>-1||e[f].search(/xmlns\=/)>-1?i+=a[o]+e[f]:i+=e[f];return"\n"===i[0]?i.slice(1):i}var r="vertices",e="edges",t="faces",u="boundaries",o="boundary",i="mountain",c="valley",a="mark",l="unassigned",f="front",s="back",d="svg",h="class",v="index",p="object",m="string",g="undefined",y="black",b="white",S="lightgray",w="stroke-width",_="createElementNS",j="setAttributeNS",E="appendChild",N="vertices_coords",k="edges_vertices",O="faces_vertices",x="faces_edges",G="edges_assignment",V="faces_re:matrix",A="faces_re:layer",M="frame_classes",T="file_classes";function z(n){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function C(n,r){return function(n){if(Array.isArray(n))return n}(n)||function(n,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(n)))return;var e=[],t=!0,u=!1,o=void 0;try{for(var i,c=n[Symbol.iterator]();!(t=(i=c.next()).done)&&(e.push(i.value),!r||e.length!==r);t=!0);}catch(n){u=!0,o=n}finally{try{t||null==c["return"]||c["return"]()}finally{if(u)throw o}}return e}(n,r)||F(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(n){return function(n){if(Array.isArray(n))return P(n)}(n)||function(n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||F(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(n,r){if(n){if("string"==typeof n)return P(n,r);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?P(n,r):void 0}}function P(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=new Array(r);e<r;e++)t[e]=n[e];return t}var B=("undefined"==typeof window?"undefined":z(window))!==g&&z(window.document)!==g,I=("undefined"==typeof process?"undefined":z(process))!==g&&null!=process.versions&&null!=process.versions.node,L=(("undefined"==typeof self?"undefined":z(self))===p&&self.constructor&&self.constructor.name,function(){var n={};if(I){var r=require("xmldom"),e=r.DOMParser,t=r.XMLSerializer;n.DOMParser=e,n.XMLSerializer=t,n.document=(new e).parseFromString("<!DOCTYPE html><title>.</title>","text/html")}else B&&(n=window);return n}()),U="http://www.w3.org/2000/svg",X={SVG:{NS:U,g:function(){return L.document[_](U,"g")},defs:function(){return L.document[_](U,"defs")},style:function(){var n=L.document[_](U,"style");return n[j](null,"type","text/css"),n},line:function(n,r,e,t){var u=L.document[_](U,"line");return u[j](null,"x1",n),u[j](null,"y1",r),u[j](null,"x2",e),u[j](null,"y2",t),u},circle:function(n,r,e){var t=L.document[_](U,"circle");return t[j](null,"cx",n),t[j](null,"cy",r),t[j](null,"r",e),t},polygon:function(n){var r=L.document[_](U,"polygon"),e=n.map((function(n){return"".concat(n[0],",").concat(n[1])})).join(" ");return r[j](null,"points",e),r},path:function(n){var r=L.document[_](U,"path");return r[j](null,"d",n),r}}},Y=function n(r){return Object.freeze(r),void 0===r||Object.getOwnPropertyNames(r).filter((function(n){return null!==r[n]&&(z(r[n])===p||"function"===z(r[n]))&&!Object.isFrozen(r[n])})).forEach((function(e){return n(r[e])})),r},q=function n(r,e){return Object.keys(e).forEach((function(t){z(e[t])===p&&null!==e[t]?(t in r||(r[t]={}),n(r[t],e[t])):z(r)!==p||t in r||(r[t]=e[t])})),r},J=function(n){if(null==n)return{};if(z(n)===p&&null!==n)return n;if(z(n)===m||n instanceof String)try{return JSON.parse(n)}catch(n){return{}}return{}},$=function(n){if(n[O]){var r=n[O].length,e=Array.from(Array(r)).map((function(){return[]})),t={};return n[O].forEach((function(n,r){if(void 0!==n){var u=n.length;n.forEach((function(n,o,i){var c=i[(o+1)%u];if(c<n){var a=[c,n];n=a[0],c=a[1]}var l="".concat(n," ").concat(c);if(l in t){var f=t[l];e[r].push(f),e[f].push(r)}else t[l]=r}))}})),e}},H=function(n){if(!n[k])return{};var r={};return n[k].map((function(n){return n.sort((function(n,r){return n-r})).join(" ")})).forEach((function(n,e){r[n]=e})),r},K=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=H(n),t=$(n);if(t.length<=0)return[];var u=[r],o=[[{face:r,parent:void 0,edge:void 0,level:0}]];do{o[o.length]=o[o.length-1].map((function(r){var o=t[r.face].filter((function(n){return-1===u.indexOf(n)}));return u=u.concat(o),o.map((function(t){var u=n.faces_vertices[t].filter((function(e){return-1!==n.faces_vertices[r.face].indexOf(e)})).sort((function(n,r){return n-r})),o=e[u.join(" ")];return{face:t,parent:r.face,edge:o,edge_vertices:u}}))})).reduce((function(n,r){return n.concat(r)}),[])}while(o[o.length-1].length>0);return o.length>0&&0===o[o.length-1].length&&o.pop(),o},Q=function(n){if(null==n[N]||n[N].length<=0)return[0,0,0,0];var r=n[N][0].length,e=Array(r).fill(1/0),t=Array(r).fill(-1/0);return n[N].forEach((function(n){return n.forEach((function(n,r){n<e[r]&&(e[r]=n),n>t[r]&&(t[r]=n)}))})),isNaN(e[0])||isNaN(e[1])||isNaN(t[0])||isNaN(t[1])?[0,0,0,0]:[e[0],e[1],t[0]-e[0],t[1]-e[1]]},R=function(n){if(null==n[G])return{vertices:[],edges:[]};for(var r=n[G].map((function(n){return"B"===n||"b"===n})),e=function(n){if(n[k]){var r=[];return n[k].forEach((function(n,e){return n.forEach((function(n){void 0===r[n]&&(r[n]=[]),r[n].push(e)}))})),r}}(n),t=[],u=[],o=-1,i=0;i<r.length;i+=1)if(r[i]){o=i;break}if(-1===o)return{vertices:[],edges:[]};r[o]=!1,t.push(o),u.push(n[k][o][0]);for(var c=n[k][o][1];u[0]!==c;){if(u.push(c),void 0===(o=e[c].filter((function(n){return r[n]})).shift()))return{vertices:[],edges:[]};if(n[k][o][0]===c)c=C(n[k][o],2)[1];else c=C(n[k][o],1)[0];r[o]=!1,t.push(o)}return{vertices:u,edges:t}},W="none",Z="500px",nn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Y({input:m,output:m,padding:null,file_frame:null,stylesheet:null,shadows:null,boundaries:!0,faces:!0,edges:!0,vertices:!1,attributes:{svg:{width:Z,height:Z,stroke:y,fill:W,"stroke-linejoin":"bevel","stroke-width":n/200},circle:{r:n/200},boundaries:{fill:b},faces:{stroke:W,front:{stroke:y,fill:S},back:{stroke:y,fill:b}},edges:{boundary:{},mountain:{stroke:"red"},valley:{stroke:"blue"},mark:{stroke:S},unassigned:{stroke:S}},vertices:{stroke:W,fill:y}}})},rn=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=Q(n),t=Math.min(e[2],e[3]);return q(r,nn(t)),r.shadows&&q(r,{attributes:{faces:{front:{filter:"url(#shadow)"},back:{filter:"url(#shadow)"}}}}),r},en=function(n){if(N in n==!1||k in n==!1||G in n==!1)return[];var r=R(n).vertices.map((function(r){return n[N][r]}));if(0===r.length)return[];var e=X.SVG.polygon(r);return e[j](null,h,o),[e]},tn=function(n,r){if(N in n==!1)return[];var e=n[N].map((function(n){return X.SVG.circle(n[0],n[1],.01)}));return e.forEach((function(n,r){return n[j](null,v,r)})),e},un={B:o,b:o,M:i,m:i,V:c,v:c,F:a,f:a,U:l,u:l},on={B:"b",b:"b",M:"m",m:"m",V:"v",v:"v",F:"f",f:"f",U:"u",u:"u"},cn=function(n){return null==n[k]||null==n[N]?[]:n[k].map((function(r){return r.map((function(r){return n[N][r]}))}))},an=function(n){return"M".concat(n[0][0]," ").concat(n[0][1],"L").concat(n[1][0]," ").concat(n[1][1])},ln=function(n){var r=cn(n).map((function(n){return an(n)})).join("");return""===r?void 0:r},fn=function(n){if(null==n[k]||null==n[N]||null==n[G])return[];var r=cn(n),e=function(n){var r={u:[],f:[],v:[],m:[],b:[]};return n[G].map((function(n){return on[n]})).forEach((function(n,e){return r[n].push(e)})),r}(n),t=Object.keys(e).map((function(n){return e[n].map((function(n){return r[n]}))})).map((function(n){return n.map((function(n){return an(n)})).join("")})),u={};return Object.keys(e).map((function(n,r){""!==t[r]&&(u[n]=t[r])})),u},sn=function(n){if(null==n[G]){var r=ln(n);return void 0===r?[]:[X.SVG.path(r)]}var e=fn(n);return Object.keys(e).map((function(n){var r=X.SVG.path(e[n]);return r[j](null,h,un[n]),r}))},dn=function(n){var r=n["faces_re:coloring"];return null==r&&(r=V in n?n[V].map((function(n){return n[0]*n[3]-n[1]*n[2]})).map((function(n){return n>=0})):function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=[];return e[r]=!0,K(n,r).forEach((function(n,r){return n.forEach((function(n){e[n.face]=r%2==0}))})),e}(n,0)),r.map((function(n){return n?f:s}))},hn=function(n,r){var e,t=z(n.frame_classes)===p&&null!==n.frame_classes&&!n.frame_classes.includes("creasePattern"),u=null!=n[A]&&n[A].length===n[O].length;return u&&t&&dn(n).forEach((function(n,e){return r[e][j](null,h,n)})),u?(e=n[A],e.map((function(n,r){return{layer:n,i:r}})).sort((function(n,r){return n.layer-r.layer})).map((function(n){return n.i}))).map((function(n){return r[n]})):r},vn=function(n){if(O in n==!1||N in n==!1)return[];var r=n[O].map((function(r){return r.map((function(r){return[0,1].map((function(e){return n[N][r][e]}))}))})).map((function(n){return X.SVG.polygon(n)}));return r.forEach((function(n,r){return n[j](null,v,r)})),hn(n,r)},pn=function(n){if(x in n==!1||k in n==!1||N in n==!1)return[];var r=n[x].map((function(r){return r.map((function(r){return n[k][r]})).map((function(n,r,e){var t=e[(r+1)%e.length];return n[1]===t[0]||n[1]===t[1]?n[0]:n[1]})).map((function(r){return[0,1].map((function(e){return n[N][r][e]}))}))})).map((function(n){return X.SVG.polygon(n)}));return r.forEach((function(n,r){return n[j](null,v,r)})),hn(n,r)},mn={vertices:[],edges:[l,a,c,i,o],faces:[f,s],boundaries:[]},gn=function(n,r,e){var t=r.attributes,u=mn[e]||[];Array.from(n.childNodes).filter((function(n){return t[n.nodeName]})).forEach((function(n){return Object.keys(t[n.nodeName]).forEach((function(r){return n[j](null,r,t[n.nodeName][r])}))})),Object.keys(t[e]).filter((function(n){return!u.includes(n)})).forEach((function(r){return n[j](null,r,t[e][r])})),0!==u.length&&Array.from(n.childNodes).forEach((function(n){return Object.keys(t[e][n.getAttribute(h)]||{}).forEach((function(r){return n[j](null,r,t[e][n.getAttribute(h)][r])}))}))},yn={vertices:tn,edges:sn,faces:function(n){return null!=n[O]?vn(n):pn(n)},boundaries:en},bn=function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.attributes||(o.attributes={}),[u,e,t,r].filter((function(n){return!0===o[n]})).map((function(r){var e=X.SVG.g();return e[j](null,h,r),yn[r](n,o).forEach((function(n){return e[E](n)})),gn(e,o,r),e})).filter((function(n){return n.childNodes.length>0}))},Sn=L.document,wn=Object.freeze({blur:.005,opacity:.3,color:y}),_n="result",jn="in",En="blur",Nn="offsetColor",kn="offsetBlur",On="feMergeNode",xn="200%",Gn=function(n,r){var e=Q(n),t=Math.min(e[2],e[3]),u=X.SVG.defs();if(null!=r.stylesheet){var o=X.SVG.style();u[E](o);var i=r.attributes.svg[w]?r.attributes.svg[w]:t/200,c=(new L.DOMParser).parseFromString("<xml></xml>","application/xml").createCDATASection("\n* { --".concat(w,": ").concat(i,"; }\n").concat(r.stylesheet));o[E](c)}if(null!=r.shadows){var a=z(r.shadows)===p&&null!==r.shadows?r.shadows:{blur:t/200};u[E](function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wn,r="shadow";z(n)===p&&null!==n||(n={}),Object.keys(wn).filter((function(r){return!(r in n)})).forEach((function(r){n[r]=wn[r]}));var e=Sn[_](X.SVG.NS,"filter");e[j](null,"width",xn),e[j](null,"height",xn),e[j](null,"id",r);var t=Sn[_](X.SVG.NS,"feGaussianBlur");t[j](null,jn,"SourceAlpha"),t[j](null,"stdDeviation",n.blur),t[j](null,_n,En);var u=Sn[_](X.SVG.NS,"feOffset");u[j](null,jn,En),u[j](null,_n,kn);var o=Sn[_](X.SVG.NS,"feFlood");o[j](null,"flood-color",n.color),o[j](null,"flood-opacity",n.opacity),o[j](null,_n,Nn);var i=Sn[_](X.SVG.NS,"feComposite");i[j](null,jn,Nn),i[j](null,"in2",kn),i[j](null,"operator",jn),i[j](null,_n,kn);var c=Sn[_](X.SVG.NS,"feMerge"),a=Sn[_](X.SVG.NS,On),l=Sn[_](X.SVG.NS,On);return l[j](null,jn,"SourceGraphic"),c[E](a),c[E](l),e[E](t),e[E](u),e[E](o),e[E](i),e[E](c),e}(a))}return null!=r.stylesheet||null!=r.shadows?u:void 0},Vn=function(n,r,e,t){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=1,i=e/o-e,c=n-i-u,a=r-i-u,l=e+2*i+2*u,f=t+2*i+2*u;return[c,a,l,f].join(" ")},An=function(n,r){var e=Q(n),t=(Math.min(e[2],e[3]),{viewBox:Vn.apply(void 0,D(e).concat([r.padding]))}),u=function(n){return[(null!=n[T]?n[T]:[]).join(" "),(null!=n[M]?n[M]:[]).join(" ")].filter((function(n){return""!==n})).join(" ")}(n);return""!==u&&(t[h]=u),Object.assign(t,r.attributes.svg),t},Mn=function(n,r,e){rn(r,e);var t=Gn(r,e);t&&n[E](t),bn(r,e).forEach((function(r){return n[E](r)}));var u=An(r,e);return Object.keys(u).forEach((function(r){return n[j](null,r,u[r])})),n},Tn=function(){var n=L.document[_](X.SVG.NS,d);return n.setAttribute("version","1.1"),n.setAttribute("xmlns",X.SVG.NS),n},zn=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=J(r);rn(t,e);var u=Mn(Tn(),t,e);if(e.output===d)return u;var o=(new L.XMLSerializer).serializeToString(u),i=n(o);return i};return Object.assign(zn,{render_into_svg:Mn,render_components:bn,boundaries_polygon:en,vertices_circle:tn,edges_path_data:ln,edges_by_assignment_paths_data:fn,edges_path:sn,edges_line:function(n){var r=cn(n).map((function(n){return X.SVG.line(n[0][0],n[0][1],n[1][0],n[1][1])}));return r.forEach((function(n,r){return n[j](null,v,r)})),function(n){return null==n[k]||null==n[G]||n[k].length!==n[G].length?[]:n[G].map((function(n){return un[n]}))}(n).forEach((function(n,e){return r[e][j](null,h,n)})),r},faces_vertices_polygon:vn,faces_edges_polygon:pn,linker:function(n){}.bind(zn),use:function(n){n.NS&&(X.SVG=n)}}),zn}));
