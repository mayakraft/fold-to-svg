"use strict";/* (c) Robby Kraft, MIT License */require("core-js/modules/es6.regexp.search"),require("core-js/modules/es6.regexp.replace"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.array.sort"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/web.dom.iterable"),require("core-js/modules/es7.symbol.async-iterator"),require("core-js/modules/es6.symbol"),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.drawFOLD=b()}(void 0,function(){'use strict';function a(b){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){return e(a)||g(a,b)||j()}function c(a){return d(a)||f(a)||h()}function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function e(a){if(Array.isArray(a))return a}function f(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function g(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function k(a,b){for(var c=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),d=c.length,e=!1,f=0,g="",h=null!=b&&"string"==typeof b?b:"\t",i=["\n"],j=0;100>j;j+=1)i.push(i[j]+h);for(var k=0;k<d;k+=1)-1<c[k].search(/<!/)?(g+=i[f]+c[k],e=!0,(-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)||-1<c[k].search(/!DOCTYPE/))&&(e=!1)):-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)?(g+=c[k],e=!1):/^<\w/.exec(c[k-1])&&/^<\/\w/.exec(c[k])&&/^<[\w:\-\.\,]+/.exec(c[k-1])==/^<\/[\w:\-\.\,]+/.exec(c[k])[0].replace("/","")?(g+=c[k],e||(f-=1)):-1<c[k].search(/<\w/)&&-1===c[k].search(/<\//)&&-1===c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f++]+c[k]:-1<c[k].search(/<\w/)&&-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[f]+c[k]:-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[--f]+c[k]:-1<c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f]+c[k]:g+=-1<c[k].search(/<\?/)?i[f]+c[k]:-1<c[k].search(/xmlns\:/)||-1<c[k].search(/xmlns\=/)?i[f]+c[k]:c[k];return"\n"===g[0]?g.slice(1):g}function l(a,b){void 0===a["re:diagrams"]||0===a["re:diagrams"].length||Array.from(a["re:diagrams"]).forEach(function(c){if(!0=="re:diagram_lines"in c&&c["re:diagram_lines"].forEach(function(a){var c="re:diagram_line_classes"in a?a["re:diagram_line_classes"].join(" "):"valley",d=a["re:diagram_line_coords"];if(void 0!==d){var e=H(d[0][0],d[0][1],d[1][0],d[1][1]);e.setAttribute("class",c),b.appendChild(e)}}),!0=="re:diagram_arrows"in c){var d=p(a),e=d[2]>d[3]?d[3]:d[2],f={length:.09*e,width:.035*e,strokeWidth:.02*e};c["re:diagram_arrows"].forEach(function(a){var c=Math.abs;if(2===a["re:diagram_arrow_coords"].length){var d=a["re:diagram_arrow_coords"],e=d[0][0]<d[1][0];.1>c(d[0][0]-d[1][0])&&(e=d[0][1]<d[1][1]?.5>d[0][0]:.5<d[0][0]),.1>c(d[0][1]-d[1][1])&&(e=d[0][0]<d[1][0]?.5<d[0][1]:.5>d[0][1]),f.side=e;var g=L(d[0],d[1],f);b.appendChild(g)}})}})}var m=function(a){var b=a.vertices_coords.map(function(){return[]});return a.edges_vertices.forEach(function(a,c){return a.forEach(function(a){return b[a].push(c)})}),b},n=function(a){for(var c=a.edges_assignment.map(function(b){return"B"===b||"b"===b}),d=m(a),e=[],f=[],g=-1,h=0;h<c.length;h+=1)if(c[h]){g=h;break}if(-1===g)return{vertices:[],edges:[]};c[g]=!1,e.push(g),f.push(a.edges_vertices[g][0]);for(var j=a.edges_vertices[g][1];f[0]!==j;){if(f.push(j),g=d[j].filter(function(a){return c[a]}).shift(),a.edges_vertices[g][0]===j){var k=b(a.edges_vertices[g],2);j=k[1]}else{var l=b(a.edges_vertices[g],1);j=l[0]}c[g]=!1,e.push(g)}return{vertices:f,edges:e}},p=function(a){if(!1=="vertices_coords"in a||0>=a.vertices_coords.length)return[0,0,0,0];var b=a.vertices_coords[0].length,c=Array(b).fill(1/0),d=Array(b).fill(-Infinity);return a.vertices_coords.forEach(function(a){return a.forEach(function(a,b){a<c[b]&&(c[b]=a),a>d[b]&&(d[b]=a)})}),isNaN(c[0])||isNaN(c[1])||isNaN(d[0])||isNaN(d[1])?[0,0,0,0]:[c[0],c[1],d[0]-c[0],d[1]-c[1]]},q=function(a){var b=a.faces_vertices.length,c=Array.from(Array(b)).map(function(){return[]}),d={};return a.faces_vertices.forEach(function(a,b){if(void 0!==a){var e=a.length;a.forEach(function(a,f,g){var h=g[(f+1)%e];if(h<a){var i=[h,a];a=i[0],h=i[1]}var j="".concat(a," ").concat(h);if(j in d){var k=d[j];c[b].push(k),c[k].push(b)}else d[j]=b})}}),c},r=function(a){return a.map(function(a){return a[0]*a[3]-a[1]*a[2]}).map(function(a){return 0<=a})},s=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=[];return c[b]=!0,t(a,b).forEach(function(a,b){a.forEach(function(a){c[a.face]=0==b%2})}),c},t=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=make_vertex_pair_to_edge_map(a),d=q(a);if(0>=d.length)return[];var e=[b],f=[[{face:b,parent:void 0,edge:void 0,level:0}]];do f[f.length]=f[f.length-1].map(function(b){var f=d[b.face].filter(function(a){return-1===e.indexOf(a)});return e=e.concat(f),f.map(function(d){var e=a.faces_vertices[d].filter(function(c){return-1!==a.faces_vertices[b.face].indexOf(c)}).sort(function(c,a){return c-a}),f=c[e.join(" ")];return{face:d,parent:b.face,edge:f,edge_vertices:e}})}).reduce(function(a,b){return a.concat(b)},[]);while(0<f[f.length-1].length);return 0<f.length&&0===f[f.length-1].length&&f.pop(),f},u=function b(c){var d,e;if("object"!==a(c))return c;if(!c)return c;if("[object Array]"===Object.prototype.toString.apply(c)){for(d=[],e=0;e<c.length;e+=1)d[e]=b(c[e]);return d}for(e in d={},c)c.hasOwnProperty(e)&&(d[e]=b(c[e]));return d},v=function(a,b){if(!1=="file_frames"in a||a.file_frames.length<b)return a;var c=["frame_parent","frame_inherit"],d={visited_frames:[]};return function a(b,c,e){if(-1!==d.visited_frames.indexOf(c))throw new Error("encountered a cycle in file_frames. can't flatten.");return d.visited_frames.push(c),e=[c].concat(e),0===c?e:b.file_frames[c-1].frame_inherit&&null!=b.file_frames[c-1].frame_parent?a(b,b.file_frames[c-1].frame_parent,e):e}(a,b,[]).map(function(b){if(0===b){var d=a.file_frames;a.file_frames=null;var e=u(a);return a.file_frames=d,delete e.file_frames,c.forEach(function(a){return delete e[a]}),e}var f=u(a.file_frames[b-1]);return c.forEach(function(a){return delete f[a]}),f}).reduce(function(a,b){return Object.assign(a,b)},{})},w="undefined"!=typeof window&&"undefined"!=typeof window.document,x="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,y="object"===("undefined"==typeof self?"undefined":a(self))&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,z={};if(x){var A=require("xmldom"),B=A.DOMParser,C=A.XMLSerializer;z.DOMParser=B,z.XMLSerializer=C,z.document=new B().parseFromString("<!DOCTYPE html><title>a</title>","text/html")}else w&&(z.DOMParser=window.DOMParser,z.XMLSerializer=window.XMLSerializer,z.document=window.document);var D=function(){var a=z.document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("version","1.1"),a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a},E=function(){var a=z.document.createElementNS("http://www.w3.org/2000/svg","g");return a},F=function(){var a=z.document.createElementNS("http://www.w3.org/2000/svg","style");return a.setAttribute("type","text/css"),a},G=function(a,b,c,e,f){var g=5<arguments.length&&arguments[5]!==void 0?arguments[5]:0,h=e/1-e,d=[b-h-g,c-h-g,e+2*h+2*g,f+2*h+2*g].join(" ");a.setAttributeNS(null,"viewBox",d)},H=function(a,b,c,d){var e=z.document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttributeNS(null,"x1",a),e.setAttributeNS(null,"y1",b),e.setAttributeNS(null,"x2",c),e.setAttributeNS(null,"y2",d),e},I=function(a,b,c){var d=z.document.createElementNS("http://www.w3.org/2000/svg","circle");return d.setAttributeNS(null,"cx",a),d.setAttributeNS(null,"cy",b),d.setAttributeNS(null,"r",c),d},J=function(a){var b=z.document.createElementNS("http://www.w3.org/2000/svg","polygon"),c=a.reduce(function(c,a){return"".concat(c).concat(a[0],",").concat(a[1]," ")},"");return b.setAttributeNS(null,"points",c),b},K=function(a,b,c,e,f,g,h,i){var j=[[a,b],[c,e],[f,g],[h,i]].map(function(a){return a.join(",")}),k="M ".concat(j[0]," C ").concat(j[1]," ").concat(j[2]," ").concat(j[3]),d=z.document.createElementNS("http://www.w3.org/2000/svg","path");return d.setAttributeNS(null,"d",k),d},L=function(b,c,d){var e=Math.sqrt,f={color:"#000",strokeWidth:.5,width:.5,length:2,bend:.3,pinch:.618,padding:.5,side:!0,start:!1,end:!0,strokeStyle:"",fillStyle:""};"object"===a(d)&&null!==d&&Object.assign(f,d);var g=["stroke:none","fill:".concat(f.color),f.fillStyle].filter(function(b){return""!==b}).join(";"),h=["fill:none","stroke:".concat(f.color),"stroke-width:".concat(f.strokeWidth),f.strokeStyle].filter(function(b){return""!==b}).join(";"),i=b,j=c,k=[j[0]-i[0],j[1]-i[1]],l=[i[0]+k[0]/2,i[1]+k[1]/2],m=e(k[0]*k[0]+k[1]*k[1]),n=2.5*((f.start?1+f.padding:0+f.end?1+f.padding:0)*f.length);if(m<n){var o=[k[0]/m*n,k[1]/m*n];i=[l[0]-.5*o[0],l[1]-.5*o[1]],j=[l[0]+.5*o[0],l[1]+.5*o[1]],k=[j[0]-i[0],j[1]-i[1]]}var p=[k[1],-k[0]],q=[l[0]+p[0]*(f.side?1:-1)*f.bend,l[1]+p[1]*(f.side?1:-1)*f.bend],r=[q[0]-i[0],q[1]-i[1]],s=[q[0]-j[0],q[1]-j[1]],t=e(r[0]*r[0]+r[1]*r[1]),u=e(s[0]*s[0]+s[1]*s[1]),v=[r[0]/t,r[1]/t],w=[s[0]/u,s[1]/u],x=[-v[0],-v[1]],y=[-w[0],-w[1]],A=[x[1],-x[0]],B=[y[1],-y[0]],C=[i[0]+v[0]*f.length*((f.start?1:0)+f.padding),i[1]+v[1]*f.length*((f.start?1:0)+f.padding)],D=[j[0]+w[0]*f.length*((f.end?1:0)+f.padding),j[1]+w[1]*f.length*((f.end?1:0)+f.padding)];k=[D[0]-C[0],D[1]-C[1]],p=[k[1],-k[0]],l=[C[0]+k[0]/2,C[1]+k[1]/2],q=[l[0]+p[0]*(f.side?1:-1)*f.bend,l[1]+p[1]*(f.side?1:-1)*f.bend];var E=[C[0]+(q[0]-C[0])*f.pinch,C[1]+(q[1]-C[1])*f.pinch],F=[D[0]+(q[0]-D[0])*f.pinch,D[1]+(q[1]-D[1])*f.pinch],G=[[C[0]+A[0]*-f.width,C[1]+A[1]*-f.width],[C[0]+A[0]*f.width,C[1]+A[1]*f.width],[C[0]+x[0]*f.length,C[1]+x[1]*f.length]],H=[[D[0]+B[0]*-f.width,D[1]+B[1]*-f.width],[D[0]+B[0]*f.width,D[1]+B[1]*f.width],[D[0]+y[0]*f.length,D[1]+y[1]*f.length]],I=z.document.createElementNS("http://www.w3.org/2000/svg","g"),L=K(C[0],C[1],E[0],E[1],F[0],F[1],D[0],D[1]);if(L.setAttribute("style",h),I.appendChild(L),f.start){var M=J(G);M.setAttribute("style",g),I.appendChild(M)}if(f.end){var N=J(H);N.setAttribute("style",g),I.appendChild(N)}return I},M={B:"boundary",b:"boundary",M:"mountain",m:"mountain",V:"valley",v:"valley",F:"mark",f:"mark",U:"mark",u:"mark"},N=function(a){return a.map(function(a,b){return{layer:a,i:b}}).sort(function(c,a){return c.layer-a.layer}).map(function(a){return a.i})},O=function(a){var b=a["faces_re:coloring"];return null==b&&(b="faces_re:matrix"in a?r(a["faces_re:matrix"]):s(a,0)),b.map(function(a){return a?"front":"back"})},P=function(a,b){var c=null!=a["faces_re:layer"]&&a["faces_re:layer"].length===a.faces_vertices.length;return c&&O(a).forEach(function(a,c){return b[c].setAttribute("class",a)}),c?N(a["faces_re:layer"]).map(function(a){return b[a]}):b},Q=function(a){return null==a.edges_vertices||null==a.edges_assignment||a.edges_vertices.length!==a.edges_assignment.length?[]:a.edges_assignment.map(function(b){return M[b]})},R=function(a){if(!1=="edges_vertices"in a||!1=="vertices_coords"in a)return[];var b=n(a).vertices.map(function(b){return a.vertices_coords[b]}),c=J(b);return c.setAttribute("class","boundary"),[c]},S=function(a,b){if(!1=="vertices_coords"in a)return[];var c=b&&b.radius?b.radius:.01,d=a.vertices_coords.map(function(a){return I(a[0],a[1],c)});return d.forEach(function(a,b){return a.setAttribute("id","".concat(b))}),d},T=function(a){if(!1=="edges_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.edges_vertices.map(function(b){return b.map(function(b){return a.vertices_coords[b]})}).map(function(a){return H(a[0][0],a[0][1],a[1][0],a[1][1])});return b.forEach(function(a,b){return a.setAttribute("id","".concat(b))}),Q(a).forEach(function(c,a){return b[a].setAttribute("class",c)}),b},U=function(a){if(!1=="faces_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.faces_vertices.map(function(b){return b.map(function(b){return a.vertices_coords[b]})}).map(function(a){return J(a)});return b.forEach(function(a,b){return a.setAttribute("id","".concat(b))}),P(a,b)},V=function(a){if(!1=="faces_edges"in a||!1=="edges_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.faces_edges.map(function(b){return b.map(function(b){return a.edges_vertices[b]}).map(function(a,b,c){var d=c[(b+1)%c.length];return a[1]===d[0]||a[1]===d[1]?a[0]:a[1]}).map(function(b){return a.vertices_coords[b]})}).map(function(a){return J(a)});return b.forEach(function(a,b){return a.setAttribute("id","".concat(b))}),P(a,b)},W=z.document,X="http://www.w3.org/2000/svg",Y=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"shadow",b=W.createElementNS(X,"defs"),c=W.createElementNS(X,"filter");c.setAttribute("width","200%"),c.setAttribute("height","200%"),c.setAttribute("id",a);var d=W.createElementNS(X,"feGaussianBlur");d.setAttribute("in","SourceAlpha"),d.setAttribute("stdDeviation","0.005"),d.setAttribute("result","blur");var e=W.createElementNS(X,"feOffset");e.setAttribute("in","blur"),e.setAttribute("result","offsetBlur");var f=W.createElementNS(X,"feFlood");f.setAttribute("flood-color","#000"),f.setAttribute("flood-opacity","0.3"),f.setAttribute("result","offsetColor");var g=W.createElementNS(X,"feComposite");g.setAttribute("in","offsetColor"),g.setAttribute("in2","offsetBlur"),g.setAttribute("operator","in"),g.setAttribute("result","offsetBlur");var h=W.createElementNS(X,"feMerge"),i=W.createElementNS(X,"feMergeNode"),j=W.createElementNS(X,"feMergeNode");return j.setAttribute("in","SourceGraphic"),h.appendChild(i),h.appendChild(j),b.appendChild(c),c.appendChild(d),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),b},Z={vertices:"vertices",edges:"creases",faces:"faces",boundaries:"boundaries"},$=function(a){return!0=="faces_vertices"in a?U(a):!0=="faces_edges"in a?V(a):[]},_={vertices:S,edges:T,faces:$,boundaries:R},aa=function(a){var b=(null==a.file_classes?[]:a.file_classes).join(" "),c=(null==a.frame_classes?[]:a.frame_classes).join(" ");return[b,c].filter(function(a){return""!==a}).join(" ")},ba=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=a,e={defaults:!0,width:"500px",height:"500px",inlineStyle:!0,stylesheet:"svg * {\n  stroke-width: var(--crease-width);\n  stroke-linecap: round;\n  stroke: black;\n}\npolygon { fill: none; stroke: none; stroke-linejoin: bevel; }\n.boundary { fill: white; stroke: black;}\n.mark { stroke: #aaa;}\n.mountain { stroke: #f00;}\n.valley {\n  stroke: #00f;\n  stroke-dasharray: calc(var(--crease-width) * 2) calc(var(--crease-width) * 2);\n}\n.foldedForm .boundary { fill: none;stroke: none; }\n.foldedForm .faces polygon { stroke: black; }\n.foldedForm .faces .front { fill: #fff; }\n.foldedForm .faces .back { fill: #ddd; }\n.foldedForm .creases line { stroke: none; }\n",shadows:!1,padding:0,viewBox:null,boundaries:!0,faces:!0,edges:!0,vertices:!1};Object.assign(e,b),null!=e.frame&&(d=v(a,e.frame)),null==e.svg&&(e.svg=D()),e.svg.setAttribute("class",aa(d)),e.svg.setAttribute("width",e.width),e.svg.setAttribute("height",e.height);var f=F();e.svg.appendChild(f);var g={};if(["boundaries","faces","edges","vertices"].filter(function(a){return e[a]}).forEach(function(a){g[a]=E(),g[a].setAttribute("class",Z[a]),e.svg.appendChild(g[a])}),Object.keys(g).forEach(function(b){return _[b](d).forEach(function(c){return g[b].appendChild(c)})}),"re:diagrams"in d){var h=E();e.svg.appendChild(h),l(d,h)}if(e.shadows){var i=Y("face_shadow");e.svg.appendChild(i),Array.from(g.faces.childNodes).forEach(function(a){return a.setAttribute("filter","url(#".concat("face_shadow",")"))})}var j=p(d);if(null==e.viewBox?G.apply(void 0,[e.svg].concat(c(j),[e.padding])):G.apply(void 0,[e.svg].concat(c(e.viewBox),[e.padding])),e.inlineStyle){var m=j[2]>j[3]?j[3]:j[2],n="\nsvg { --crease-width: ".concat(.005*m,"; }\n").concat(e.stylesheet),o=new z.DOMParser().parseFromString("<xml></xml>","application/xml"),q=o.createCDATASection(n);f.appendChild(q)}var r=new z.XMLSerializer().serializeToString(e.svg),s=k(r);return s},ca=function(b){if("object"===a(b)&&null!==b)return b;if("string"==typeof b||b instanceof String)try{var c=JSON.parse(b);return c}catch(a){throw a}throw new Error("couldn't recognize input. looking for string or object")};return{svg:function(a,b){try{var c=ca(a);return ba(c,b)}catch(a){throw a}},webGL:function(){},components:{svg:{boundaries:R,vertices:S,edges:T,faces_vertices:U,faces_edges:V},webGL:{}}}});
