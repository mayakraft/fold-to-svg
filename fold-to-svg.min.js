/* (c) Robby Kraft, MIT License */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.FoldToSvg=b())})(this,function(){'use strict';function a(b){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){return e(a)||g(a,b)||j()}function c(a){return d(a)||f(a)||h()}function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function e(a){if(Array.isArray(a))return a}function f(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function g(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function k(a,b){for(var c=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),d=c.length,e=!1,f=0,g="",h=null!=b&&"string"==typeof b?b:"\t",i=["\n"],j=0;100>j;j+=1)i.push(i[j]+h);for(var k=0;k<d;k+=1)-1<c[k].search(/<!/)?(g+=i[f]+c[k],e=!0,(-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)||-1<c[k].search(/!DOCTYPE/))&&(e=!1)):-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)?(g+=c[k],e=!1):/^<\w/.exec(c[k-1])&&/^<\/\w/.exec(c[k])&&/^<[\w:\-\.\,]+/.exec(c[k-1])==/^<\/[\w:\-\.\,]+/.exec(c[k])[0].replace("/","")?(g+=c[k],e||(f-=1)):-1<c[k].search(/<\w/)&&-1===c[k].search(/<\//)&&-1===c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f++]+c[k]:-1<c[k].search(/<\w/)&&-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[f]+c[k]:-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[--f]+c[k]:-1<c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f]+c[k]:g+=-1<c[k].search(/<\?/)?i[f]+c[k]:-1<c[k].search(/xmlns\:/)||-1<c[k].search(/xmlns\=/)?i[f]+c[k]:c[k];return"\n"===g[0]?g.slice(1):g}var l="undefined"!=typeof window&&"undefined"!=typeof window.document,m="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,n="object"===("undefined"==typeof self?"undefined":a(self))&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,o=function(){var a={};if(m){var b=require("xmldom"),c=b.DOMParser,d=b.XMLSerializer;a.DOMParser=c,a.XMLSerializer=d,a.document=new c().parseFromString("<!DOCTYPE html><title> </title>","text/html")}else l&&(a=window);return a}(),q="http://www.w3.org/2000/svg",r=function(){var a=o.document.createElementNS(q,"svg");return a.setAttribute("version","1.1"),a.setAttribute("xmlns",q),a},s=function(a){var b=o.document.createElementNS(q,"g");return a&&a.appendChild(b),b},t=function a(b){var a=o.document.createElementNS(q,"defs");return b&&b.appendChild(a),a},u=function(a){var b=o.document.createElementNS(q,"style");return b.setAttribute("type","text/css"),a&&a.appendChild(b),b},v=function(a,b,c,e,f){var g=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,h=e/1-e,d=[b-h-g,c-h-g,e+2*h+2*g,f+2*h+2*g].join(" ");a.setAttributeNS(null,"viewBox",d)},w=function(a,b,c,d){var e=o.document.createElementNS(q,"line");return e.setAttributeNS(null,"x1",a),e.setAttributeNS(null,"y1",b),e.setAttributeNS(null,"x2",c),e.setAttributeNS(null,"y2",d),e},x=function(a,b,c){var d=o.document.createElementNS(q,"circle");return d.setAttributeNS(null,"cx",a),d.setAttributeNS(null,"cy",b),d.setAttributeNS(null,"r",c),d},y=function(a){var b=o.document.createElementNS(q,"polygon"),c=a.map(function(a){return"".concat(a[0],",").concat(a[1])}).join(" ");return b.setAttributeNS(null,"points",c),b},z=function(a){var b=o.document.createElementNS(q,"path");return b.setAttributeNS(null,"d",a),b},A=function(a){return null!=a&&"function"==typeof a[Symbol.iterator]},B=function b(){for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];switch(e.length){case void 0:case 0:return e;case 1:return A(e[0])&&"string"!=typeof e[0]?b.apply(void 0,c(e[0])):[e[0]];default:return Array.from(e).map(function(d){return A(d)?c(b(d)):d}).reduce(function(c,a){return c.concat(a)},[]);}},C=function(b){for(var c=Math.floor,d=arguments.length,e=Array(1<d?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];var g=B.apply(void 0,e),h="";return"number"==typeof g[0]&&(h=Array.from(Array(c(g.length/2))).reduce(function(c,a,b){return"".concat(c).concat(g[2*b],",").concat(g[2*b+1]," ")},"")),"object"===a(g[0])&&("number"==typeof g[0].x&&(h=g.reduce(function(a,b){return"".concat(a).concat(b.x,",").concat(b.y," ")},"")),"number"==typeof g[0][0]&&(h=g.reduce(function(a,b){return"".concat(a).concat(b[0],",").concat(b[1]," ")},""))),b.setAttributeNS(null,"points",h),b},D=function(b){for(var c=Math.sqrt,d=Math.pow,e=Array.from(b.childNodes),f=e.filter(function(a){return"path"===a.tagName}).shift(),g=["svg-arrow-head","svg-arrow-tail"].map(function(a){return e.filter(function(b){return b.getAttribute("class")===a}).shift()}),h=arguments.length,i=Array(1<h?h-1:0),j=1;j<h;j++)i[j-1]=arguments[j];var k=B.apply(void 0,i),l=[];if("number"==typeof k[0]&&(l=k),"object"===a(k[0])&&("number"==typeof k[0].x&&(l=k.map(function(a){return[a[0],a[1]]}).reduce(function(c,a){return c.concat(a)},[])),"number"==typeof k[0][0]&&(l=k.reduce(function(c,a){return c.concat(a)},[]))),l.length||null==b.endpoints||(l=b.endpoints),!l.length)return b;b.endpoints=l;var m=b.options,n=[l[0],l[1]],o=[l[2],l[3]],p=[o[0]-n[0],o[1]-n[1]],q=[n[0]+p[0]/2,n[1]+p[1]/2],r=c(d(p[0],2)+d(p[1],2)),s=(m.tail.visible?2.5*((1+m.tail.padding)*m.tail.height):0)+(m.head.visible?2.5*((1+m.head.padding)*m.head.height):0);if(r<s){var t=0===r?[s,0]:[p[0]/r*s,p[1]/r*s];n=[q[0]-.5*t[0],q[1]-.5*t[1]],o=[q[0]+.5*t[0],q[1]+.5*t[1]],p=[o[0]-n[0],o[1]-n[1]]}var u=[p[1],-p[0]],v=[q[0]+u[0]*m.curve,q[1]+u[1]*m.curve],w=[v[0]-n[0],v[1]-n[1]],x=[v[0]-o[0],v[1]-o[1]],y=c(d(w[0],2)+d(w[1],2)),z=c(d(x[0],2)+d(x[1],2)),A=0===y?w:[w[0]/y,w[1]/y],D=0===y?x:[x[0]/z,x[1]/z],E=[-A[0],-A[1]],F=[-D[0],-D[1]],G=[E[1],-E[0]],H=[F[1],-F[0]],I=[n[0]+A[0]*m.tail.height*((m.tail.visible?1:0)+m.tail.padding),n[1]+A[1]*m.tail.height*((m.tail.visible?1:0)+m.tail.padding)],J=[o[0]+D[0]*m.head.height*((m.head.visible?1:0)+m.head.padding),o[1]+D[1]*m.head.height*((m.head.visible?1:0)+m.head.padding)];p=[J[0]-I[0],J[1]-I[1]],u=[p[1],-p[0]],q=[I[0]+p[0]/2,I[1]+p[1]/2],v=[q[0]+u[0]*m.curve,q[1]+u[1]*m.curve];var K=[I[0]+(v[0]-I[0])*m.pinch,I[1]+(v[1]-I[1])*m.pinch],L=[J[0]+(v[0]-J[0])*m.pinch,J[1]+(v[1]-J[1])*m.pinch],M=[[I[0]+G[0]*-m.tail.width,I[1]+G[1]*-m.tail.width],[I[0]+G[0]*m.tail.width,I[1]+G[1]*m.tail.width],[I[0]+E[0]*m.tail.height,I[1]+E[1]*m.tail.height]],N=[[J[0]+H[0]*-m.head.width,J[1]+H[1]*-m.head.width],[J[0]+H[0]*m.head.width,J[1]+H[1]*m.head.width],[J[0]+F[0]*m.head.height,J[1]+F[1]*m.head.height]];return f.setAttribute("d","M".concat(I[0],",").concat(I[1],"C").concat(K[0],",").concat(K[1],",").concat(L[0],",").concat(L[1],",").concat(J[0],",").concat(J[1])),m.head.visible?(g[0].removeAttribute("display"),C(g[0],N)):g[0].setAttribute("display","none"),m.tail.visible?(g[1].removeAttribute("display"),C(g[1],M)):g[1].setAttribute("display","none"),b},E=function(b){b.head=function(c){return"object"===a(c)?(Object.assign(b.options.head,c),void 0===c.visible&&(b.options.head.visible=!0)):"boolean"==typeof c?b.options.head.visible=c:null==c&&(b.options.head.visible=!0),D(b),b},b.tail=function(c){return"object"===a(c)?(Object.assign(b.options.tail,c),void 0===c.visible&&(b.options.tail.visible=!0),b.options.tail.visible=!0):"boolean"==typeof c?b.options.tail.visible=c:null==c&&(b.options.tail.visible=!0),D(b),b},b.curve=function(a){return b.options.curve=a,D(b),b},b.pinch=function(a){return b.options.pinch=a,D(b),b}},F=function(){var b=o.document.createElementNS(q,"g"),c=o.document.createElementNS(q,"polygon"),d=o.document.createElementNS(q,"polygon"),e=o.document.createElementNS(q,"path");c.setAttributeNS(null,"class","svg-arrow-tail"),d.setAttributeNS(null,"class","svg-arrow-head"),e.setAttributeNS(null,"class","svg-arrow-path"),c.setAttributeNS(null,"style","stroke: none;"),d.setAttributeNS(null,"style","stroke: none;"),e.setAttributeNS(null,"style","fill: none;"),b.appendChild(e),b.appendChild(c),b.appendChild(d),b.options={head:{width:.5,height:2,visible:!1,padding:0},tail:{width:.5,height:2,visible:!1,padding:0},curve:0,pinch:.618,endpoints:[]};for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];return D.apply(void 0,[b].concat(g)),E(b),b.stroke=function(){for(var c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];return b.setAttributeNS.apply(b,[null,"stroke"].concat(d)),b},b.fill=function(){for(var c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];return b.setAttributeNS.apply(b,[null,"fill"].concat(d)),b},b.strokeWidth=function(){for(var c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];return b.setAttributeNS.apply(b,[null,"stroke-width"].concat(d)),b},b.setPoints=function(){for(var c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];return D.apply(void 0,[b].concat(d))},b},G=/*#__PURE__*/Object.freeze({__proto__:null,svg:r,group:s,defs:t,style:u,setViewBox:v,line:w,circle:x,polygon:y,path:z,bezier:function(a,b,c,d,e,f,g,h){var i=[[a,b],[c,d],[e,f],[g,h]].map(function(a){return a.join(",")});return z("M ".concat(i[0]," C ").concat(i[1]," ").concat(i[2]," ").concat(i[3]))},attachArrowMethods:E,arrow:F}),H=function(a,b){if(!1=="vertices_coords"in a)return[];var c=b&&b.radius?b.radius:.01,d=a.vertices_coords.map(function(a){return x(a[0],a[1],c)});return d.forEach(function(a,b){return a.setAttribute("index",b)}),d},I={B:"boundary",b:"boundary",M:"mountain",m:"mountain",V:"valley",v:"valley",F:"mark",f:"mark",U:"unassigned",u:"unassigned"},J={B:"b",b:"b",M:"m",m:"m",V:"v",v:"v",F:"f",f:"f",U:"u",u:"u"},K=function(a){var b=a.vertices_coords,c=a.edges_vertices;return null==c||null==b?[]:c.map(function(a){return a.map(function(a){return b[a]})})},L=function(a){var b=a.edges_assignment,c={u:[],f:[],v:[],m:[],b:[]};return b.map(function(b){return J[b]}).forEach(function(b,a){return c[b].push(a)}),c},M=function(a){return null==a.edges_vertices||null==a.edges_assignment||a.edges_vertices.length!==a.edges_assignment.length?[]:a.edges_assignment.map(function(b){return I[b]})},N=function(a){return"M".concat(a[0][0]," ").concat(a[0][1],"L").concat(a[1][0]," ").concat(a[1][1])},O=function(a){var b=K(a).map(function(a){return N(a)}).join("");return""===b?void 0:b},P=function(a){if(null==a.edges_vertices||null==a.vertices_coords||null==a.edges_assignment)return[];var b=K(a),c=L(a),d=Object.keys(c).map(function(a){return c[a].map(function(a){return b[a]})}).map(function(a){return a.map(function(a){return N(a)}).join("")}),e={};return Object.keys(c).map(function(a,b){""!==d[b]&&(e[a]=d[b])}),e},Q=function(a){if(null==a.edges_assignment){var b=O(a);return void 0===b?[]:[z(b)]}var c=P(a);return Object.keys(c).map(function(a){var b=z(c[a]);return b.setAttributeNS(null,"class",I[a]),b})},R=function(a){var b=a.edges_vertices;if(b){var c=[];return b.forEach(function(a,b){return a.forEach(function(a){void 0===c[a]&&(c[a]=[]),c[a].push(b)})}),c}},S=function(a){var b=a.faces_vertices;if(b){var c=b.length,d=Array.from(Array(c)).map(function(){return[]}),e={};return b.forEach(function(a,b){if(void 0!==a){var c=a.length;a.forEach(function(a,f,g){var h=g[(f+1)%c];if(h<a){var i=[h,a];a=i[0],h=i[1]}var j="".concat(a," ").concat(h);if(j in e){var k=e[j];d[b].push(k),d[k].push(b)}else e[j]=b})}}),d}},T=function(a){var b=a.edges_vertices;if(!b)return{};var c={};return b.map(function(a){return a.sort(function(c,a){return c-a}).join(" ")}).forEach(function(a,b){c[a]=b}),c},U=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=T(a),d=S(a);if(0>=d.length)return[];var e=[b],f=[[{face:b,parent:void 0,edge:void 0,level:0}]];do f[f.length]=f[f.length-1].map(function(b){var f=d[b.face].filter(function(a){return-1===e.indexOf(a)});return e=e.concat(f),f.map(function(d){var e=a.faces_vertices[d].filter(function(c){return-1!==a.faces_vertices[b.face].indexOf(c)}).sort(function(c,a){return c-a}),f=c[e.join(" ")];return{face:d,parent:b.face,edge:f,edge_vertices:e}})}).reduce(function(a,b){return a.concat(b)},[]);while(0<f[f.length-1].length);return 0<f.length&&0===f[f.length-1].length&&f.pop(),f},V=function(a){return a.map(function(a){return a[0]*a[3]-a[1]*a[2]}).map(function(a){return 0<=a})},W=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=[];return c[b]=!0,U(a,b).forEach(function(a,b){return a.forEach(function(a){c[a.face]=0==b%2})}),c},X=function(a){return a.map(function(a,b){return{layer:a,i:b}}).sort(function(c,a){return c.layer-a.layer}).map(function(a){return a.i})},Y=function(a){var b=a["faces_re:coloring"];return null==b&&(b="faces_re:matrix"in a?V(a["faces_re:matrix"]):W(a,0)),b.map(function(a){return a?"front":"back"})},Z=function(b,c){var d="object"===a(b.frame_classes)&&null!==b.frame_classes&&!b.frame_classes.includes("creasePattern"),e=null!=b["faces_re:layer"]&&b["faces_re:layer"].length===b.faces_vertices.length;return e&&d&&Y(b).forEach(function(a,b){return c[b].setAttribute("class",a)}),e?X(b["faces_re:layer"]).map(function(a){return c[a]}):c},$=function(a){if(!1=="faces_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.faces_vertices.map(function(b){return b.map(function(b){return a.vertices_coords[b]})}).map(function(a){return y(a)});return b.forEach(function(a,b){return a.setAttribute("index",b)}),Z(a,b)},_=function(a){if(!1=="faces_edges"in a||!1=="edges_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.faces_edges.map(function(b){return b.map(function(b){return a.edges_vertices[b]}).map(function(a,b,c){var d=c[(b+1)%c.length];return a[1]===d[0]||a[1]===d[1]?a[0]:a[1]}).map(function(b){return a.vertices_coords[b]})}).map(function(a){return y(a)});return b.forEach(function(a,b){return a.setAttribute("index",b)}),Z(a,b)},aa=function(a){var b=a.vertices_coords;if(null==b||0>=b.length)return[0,0,0,0];var c=b[0].length,d=Array(c).fill(1/0),e=Array(c).fill(-Infinity);return b.forEach(function(a){return a.forEach(function(a,b){a<d[b]&&(d[b]=a),a>e[b]&&(e[b]=a)})}),isNaN(d[0])||isNaN(d[1])||isNaN(e[0])||isNaN(e[1])?[0,0,0,0]:[d[0],d[1],e[0]-d[0],e[1]-d[1]]},ba=function(a){if(null==a.edges_assignment)return{vertices:[],edges:[]};for(var c=a.edges_assignment.map(function(b){return"B"===b||"b"===b}),d=R(a),e=[],f=[],g=-1,h=0;h<c.length;h+=1)if(c[h]){g=h;break}if(-1===g)return{vertices:[],edges:[]};c[g]=!1,e.push(g),f.push(a.edges_vertices[g][0]);for(var j=a.edges_vertices[g][1];f[0]!==j;){if(f.push(j),g=d[j].filter(function(a){return c[a]}).shift(),void 0===g)return{vertices:[],edges:[]};if(a.edges_vertices[g][0]===j){var k=b(a.edges_vertices[g],2);j=k[1]}else{var l=b(a.edges_vertices[g],1);j=l[0]}c[g]=!1,e.push(g)}return{vertices:f,edges:e}},ca=function b(c){var d,e;if("object"!==a(c))return c;if(!c)return c;if("[object Array]"===Object.prototype.toString.apply(c)){for(d=[],e=0;e<c.length;e+=1)d[e]=b(c[e]);return d}for(e in d={},c)c.hasOwnProperty(e)&&(d[e]=b(c[e]));return d},da=function b(c){return(Object.freeze(c),void 0===c)?c:(Object.getOwnPropertyNames(c).filter(function(b){return null!==c[b]&&("object"===a(c[b])||"function"==typeof c[b])&&!Object.isFrozen(c[b])}).forEach(function(a){return b(c[a])}),c)},ea=function(a,b){if(!1=="file_frames"in a||a.file_frames.length<b)return a;var c=["frame_parent","frame_inherit"],d={visited_frames:[]};return function a(b,c,e){if(-1!==d.visited_frames.indexOf(c))throw new Error("encountered a cycle in file_frames. can't flatten.");return d.visited_frames.push(c),e=[c].concat(e),0===c?e:b.file_frames[c-1].frame_inherit&&null!=b.file_frames[c-1].frame_parent?a(b,b.file_frames[c-1].frame_parent,e):e}(a,b,[]).map(function(b){if(0===b){var d=a.file_frames;a.file_frames=null;var e=ca(a);return a.file_frames=d,delete e.file_frames,c.forEach(function(a){return delete e[a]}),e}var f=ca(a.file_frames[b-1]);return c.forEach(function(a){return delete f[a]}),f}).reduce(function(a,b){return Object.assign(a,b)},{})},fa=function(a){var b=(null==a.file_classes?[]:a.file_classes).join(" "),c=(null==a.frame_classes?[]:a.frame_classes).join(" ");return[b,c].filter(function(a){return""!==a}).join(" ")},ga=o.document,ha="http://www.w3.org/2000/svg",ia=Object.freeze({blur:.005,opacity:.3,color:"#000"}),ja=function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ia;("object"!==a(b)||null===b)&&(b={}),Object.keys(ia).filter(function(a){return!(a in b)}).forEach(function(a){b[a]=ia[a]});var c=ga.createElementNS(ha,"filter");c.setAttribute("width","200%"),c.setAttribute("height","200%"),c.setAttribute("id","shadow");var d=ga.createElementNS(ha,"feGaussianBlur");d.setAttribute("in","SourceAlpha"),d.setAttribute("stdDeviation",b.blur),d.setAttribute("result","blur");var e=ga.createElementNS(ha,"feOffset");e.setAttribute("in","blur"),e.setAttribute("result","offsetBlur");var f=ga.createElementNS(ha,"feFlood");f.setAttribute("flood-color",b.color),f.setAttribute("flood-opacity",b.opacity),f.setAttribute("result","offsetColor");var g=ga.createElementNS(ha,"feComposite");g.setAttribute("in","offsetColor"),g.setAttribute("in2","offsetBlur"),g.setAttribute("operator","in"),g.setAttribute("result","offsetBlur");var h=ga.createElementNS(ha,"feMerge"),i=ga.createElementNS(ha,"feMergeNode"),j=ga.createElementNS(ha,"feMergeNode");return j.setAttribute("in","SourceGraphic"),h.appendChild(i),h.appendChild(j),c.appendChild(d),c.appendChild(e),c.appendChild(f),c.appendChild(g),c.appendChild(h),c},ka=function(a){if(!1=="vertices_coords"in a||!1=="edges_vertices"in a||!1=="edges_assignment"in a)return[];var b=ba(a).vertices.map(function(b){return a.vertices_coords[b]});if(0===b.length)return[];var c=y(b);return c.setAttribute("class","boundary"),[c]},la={vertices:H,edges:Q,faces:function(a){return null==a.faces_vertices?_(a):$(a)},boundaries:ka,diagrams:function(a){if(void 0!==a["re:diagrams"]&&0!==a["re:diagrams"].length){var b=[];return Array.from(a["re:diagrams"]).forEach(function(c){if(!0=="re:diagram_lines"in c&&c["re:diagram_lines"].forEach(function(a){var c="re:diagram_line_classes"in a?a["re:diagram_line_classes"].join(" "):"valley",d=a["re:diagram_line_coords"];if(void 0!==d){var e=w(d[0][0],d[0][1],d[1][0],d[1][1]);e.setAttribute("class",c),b.push(e)}}),!0=="re:diagram_arrows"in c){var d=aa(a),e=d[2]>d[3]?d[3]:d[2];c["re:diagram_arrows"].forEach(function(a){var c=Math.abs;if(2===a["re:diagram_arrow_coords"].length){var d=a["re:diagram_arrow_coords"],f=d[0][0]<d[1][0];.1>c(d[0][0]-d[1][0])&&(f=d[0][1]<d[1][1]?.5>d[0][0]:.5<d[0][0]),.1>c(d[0][1]-d[1][1])&&(f=d[0][0]<d[1][0]?.5<d[0][1]:.5>d[0][1]),b.push(F(d[0],d[1]).stroke("black").fill("black").strokeWidth(.02*e).head({width:.035*e,height:.09*e}).curve(f?.3:-.3))}})}}),b}}},ma=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return da({input:"string",output:"string",padding:null,file_frame:null,stylesheet:null,shadows:null,diagrams:!0,boundaries:!0,faces:!0,edges:!0,vertices:!1,attributes:{svg:{width:"500px",height:"500px",stroke:"black",fill:"none","stroke-linejoin":"bevel","stroke-width":a/200},boundaries:{fill:"white"},faces:{stroke:"none",front:{stroke:"black",fill:"gray"},back:{stroke:"black",fill:"white"}},edges:{boundary:{},mountain:{stroke:"red"},valley:{stroke:"blue"},mark:{stroke:"lightgray"},unassigned:{stroke:"lightgray"}},vertices:{stroke:"none",fill:"black",r:a/200}}})},na=function b(c,d){Object.keys(d).forEach(function(e){"object"===a(d[e])&&null!==d[e]?(!(e in c)&&(c[e]={}),b(c[e],d[e])):!(e in c)&&(c[e]=d[e])})},oa=function(b){var d=Math.min,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f="number"==typeof e.file_frame?ea(b,e.file_frame):b,g=aa(f),h=d(g[2],g[3]);na(e,ma(h));var i=r();v.apply(G,[i].concat(c(g),[e.padding]));var j=fa(f);""!==j&&i.setAttribute("class",j),Object.keys(e.attributes.svg).forEach(function(a){return i.setAttribute(a,e.attributes.svg[a])});var l=null!=e.stylesheet||null!=e.shadows?t(i):void 0;if(null!=e.stylesheet){var m=u(l),n=e.attributes.svg["stroke-width"]?e.attributes.svg["stroke-width"]:h/200,p=new o.DOMParser().parseFromString("<xml></xml>","application/xml").createCDATASection("\n* { --stroke-width: ".concat(n,"; }\n").concat(e.stylesheet));m.appendChild(p)}if(null!=e.shadows){var q="object"===a(e.shadows)&&null!==e.shadows?e.shadows:{blur:h/200};l.appendChild(ja(q))}e.diagrams=!!(e.diagrams&&null!=f["re:diagrams"]);var w={};if(["boundaries","edges","faces","vertices","diagrams"].filter(function(a){return!0===e[a]}).forEach(function(a){w[a]=s(),w[a].setAttribute("class",a)}),Object.keys(w).filter(function(a){return void 0!==la[a]}).forEach(function(b){return la[b](f,e).forEach(function(c){return w[b].appendChild(c)})}),Object.keys(w).filter(function(a){return 0<w[a].childNodes.length}).forEach(function(a){return i.appendChild(w[a])}),w.edges){var x=["unassigned","mark","valley","mountain","boundary"];Object.keys(e.attributes.edges).filter(function(a){return!x.includes(a)}).forEach(function(a){return w.edges.setAttribute(a,e.attributes.edges[a])}),Array.from(w.edges.childNodes).forEach(function(a){return Object.keys(e.attributes.edges[a.getAttribute("class")]||{}).forEach(function(b){return a.setAttribute(b,e.attributes.edges[a.getAttribute("class")][b])})})}if(w.faces){var y=["front","back"];Object.keys(e.attributes.faces).filter(function(a){return!y.includes(a)}).forEach(function(a){return w.faces.setAttribute(a,e.attributes.faces[a])}),Array.from(w.faces.childNodes).forEach(function(a){return Object.keys(e.attributes.faces[a.getAttribute("class")]||{}).forEach(function(b){return a.setAttribute(b,e.attributes.faces[a.getAttribute("class")][b])})}),null!=e.shadows&&Array.from(w.faces.childNodes).forEach(function(a){return a.setAttribute("filter","url(#shadow)")})}if(w.vertices&&(Object.keys(e.attributes.vertices).filter(function(a){return"r"!==a}).forEach(function(a){return w.vertices.setAttribute(a,e.attributes.vertices[a])}),Array.from(w.vertices.childNodes).forEach(function(a){return a.setAttribute("r",e.attributes.vertices.r)})),w.boundaries&&Object.keys(e.attributes.boundaries).forEach(function(a){return w.boundaries.setAttribute(a,e.attributes.boundaries[a])}),"svg"===e.output)return i;var z=new o.XMLSerializer().serializeToString(i),A=k(z);return A},pa=function(b){if(null==b)return{};if("object"===a(b)&&null!==b)return b;if("string"==typeof b||b instanceof String)try{var c=JSON.parse(b);return c}catch(a){throw a}throw new TypeError("required 'String' or 'Object'")},qa=function(a,b){try{var c=pa(a);return oa(c,b)}catch(a){throw a}};return qa.vertices_circle=H,qa.edges_path_data=O,qa.edges_by_assignment_paths_data=P,qa.edges_path=Q,qa.edges_line=function(a){var b=K(a).map(function(a){return w(a[0][0],a[0][1],a[1][0],a[1][1])});return b.forEach(function(a,b){return a.setAttributeNS(null,"index",b)}),M(a).forEach(function(c,a){return b[a].setAttributeNS(null,"class",c)}),b},qa.faces_vertices_polygon=$,qa.faces_edges_polygon=_,qa});
