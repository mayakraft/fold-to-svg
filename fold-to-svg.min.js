/* (c) Robby Kraft, MIT License */(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.FoldToSvg=t())})(this,function(){'use strict';var A=Math.PI,S=Math.atan2,E=Math.sin,N=Math.cos,j=Math.pow,C=Math.sqrt,z=Math.abs;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return r(e)||s(e,t)||d()}function n(e){return i(e)||a(e)||o()}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function r(e){if(Array.isArray(e))return e}function a(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!(t&&n.length===t));i=!0);}catch(e){r=!0,a=e}finally{try{i||null==o["return"]||o["return"]()}finally{if(r)throw a}}return n}}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function l(t){return l="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},l(t)}function g(e,t){return f(e)||m(e,t)||v()}function p(e){return _(e)||h(e)||u()}function _(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function f(e){if(Array.isArray(e))return e}function h(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function m(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!(t&&n.length===t));i=!0);}catch(e){r=!0,a=e}finally{try{i||null==o["return"]||o["return"]()}finally{if(r)throw a}}return n}}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function y(){var e=Array.from(arguments),t=e.filter(function(e){return!isNaN(e)}),n=e.filter(function(e){return e.constructor===Array});if(0===e.length)return{vector:[],origin:[]};if(!isNaN(e[0])&&4<=t.length)return{origin:[e[0],e[1]],vector:[e[2],e[3]]};if(0<n.length){if(1===n.length)return y.apply(void 0,p(n[0]));if(2===n.length)return{origin:[n[0][0],n[0][1]],vector:[n[1][0],n[1][1]]};if(4===n.length)return{origin:[n[0],n[1]],vector:[n[2],n[3]]}}if(e[0].constructor===Object){var i=[],r=[];return null==e[0].vector?null!=e[0].direction&&(i=ye(e[0].direction)):i=ye(e[0].vector),null==e[0].point?null!=e[0].origin&&(r=ye(e[0].origin)):r=ye(e[0].point),{origin:r,vector:i}}return{origin:[],vector:[]}}function x(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0!==t.length){if(1===t.length&&void 0!==t[0])return x.apply(void 0,p(t[0]));var i=Array.from(t),r=i.filter(function(e){return!isNaN(e)}),a=i.filter(function(e){return"object"===l(e)}).filter(function(e){return e.constructor===Array});return 4<=r.length?[[r[0],r[1]],[r[2],r[3]]]:2<=a.length&&!isNaN(a[0][0])?a:1!==a.length||isNaN(a[0][0][0])?void 0:a[0]}}function b(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?void 0:1===t.length&&void 0!==t[0]?b.apply(void 0,p(t[0])):Array.from(t)}function k(e,t){for(var n=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),i=n.length,r=!1,a=0,s="",o=null!=t&&"string"==typeof t?t:"\t",d=["\n"],l=0;100>l;l+=1)d.push(d[l]+o);for(var c=0;c<i;c+=1)-1<n[c].search(/<!/)?(s+=d[a]+n[c],r=!0,(-1<n[c].search(/-->/)||-1<n[c].search(/\]>/)||-1<n[c].search(/!DOCTYPE/))&&(r=!1)):-1<n[c].search(/-->/)||-1<n[c].search(/\]>/)?(s+=n[c],r=!1):/^<\w/.exec(n[c-1])&&/^<\/\w/.exec(n[c])&&/^<[\w:\-\.\,]+/.exec(n[c-1])==/^<\/[\w:\-\.\,]+/.exec(n[c])[0].replace("/","")?(s+=n[c],r||(a-=1)):-1<n[c].search(/<\w/)&&-1===n[c].search(/<\//)&&-1===n[c].search(/\/>/)?s=r?s+=n[c]:s+=d[a++]+n[c]:-1<n[c].search(/<\w/)&&-1<n[c].search(/<\//)?s=r?s+=n[c]:s+=d[a]+n[c]:-1<n[c].search(/<\//)?s=r?s+=n[c]:s+=d[--a]+n[c]:-1<n[c].search(/\/>/)?s=r?s+=n[c]:s+=d[a]+n[c]:s+=-1<n[c].search(/<\?/)?d[a]+n[c]:-1<n[c].search(/xmlns\:/)||-1<n[c].search(/xmlns\=/)?d[a]+n[c]:n[c];return"\n"===s[0]?s.slice(1):s}function w(e,t){void 0===e["re:diagrams"]||0===e["re:diagrams"].length||Array.from(e["re:diagrams"]).forEach(function(n){if(!0=="re:diagram_lines"in n&&n["re:diagram_lines"].forEach(function(e){var n="re:diagram_line_classes"in e?e["re:diagram_line_classes"].join(" "):"valley",i=e["re:diagram_line_coords"];if(void 0!==i){var r=T(i[0][0],i[0][1],i[1][0],i[1][1]);r.setAttribute("class",n),t.appendChild(r)}}),!0=="re:diagram_arrows"in n){var i=kt(e),r=i[2]>i[3]?i[3]:i[2],a={length:.09*r,width:.035*r,strokeWidth:.02*r};n["re:diagram_arrows"].forEach(function(e){if(2===e["re:diagram_arrow_coords"].length){var n=e["re:diagram_arrow_coords"],i=n[0][0]<n[1][0];.1>z(n[0][0]-n[1][0])&&(i=n[0][1]<n[1][1]?.5>n[0][0]:.5<n[0][0]),.1>z(n[0][1]-n[1][1])&&(i=n[0][0]<n[1][0]?.5<n[0][1]:.5>n[0][1]),a.side=i;var r=U(n[0],n[1],a);t.appendChild(r)}})}})}var F="undefined"!=typeof window&&"undefined"!=typeof window.document,I="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,M="object"===("undefined"==typeof self?"undefined":e(self))&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,O=function(){var e={};if(I){var t=require("xmldom"),n=t.DOMParser,i=t.XMLSerializer;e.DOMParser=n,e.XMLSerializer=i,e.document=new n().parseFromString("<!DOCTYPE html><title> </title>","text/html")}else F&&(e=window);return e}(),P="http://www.w3.org/2000/svg",B=function(){var e=O.document.createElementNS(P,"svg");return e.setAttribute("version","1.1"),e.setAttribute("xmlns",P),e},D=function(){var e=O.document.createElementNS(P,"g");return e},q=function(){var e=O.document.createElementNS(P,"style");return e.setAttribute("type","text/css"),e},L=function(e,t,n,i,r){var a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,s=i/1-i,o=[t-s-a,n-s-a,i+2*s+2*a,r+2*s+2*a].join(" ");e.setAttributeNS(null,"viewBox",o)},T=function(e,t,n,i){var r=O.document.createElementNS(P,"line");return r.setAttributeNS(null,"x1",e),r.setAttributeNS(null,"y1",t),r.setAttributeNS(null,"x2",n),r.setAttributeNS(null,"y2",i),r},W=function(e,t,n){var i=O.document.createElementNS(P,"circle");return i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",n),i},X=function(e){var t=O.document.createElementNS(P,"polygon"),n=e.reduce(function(e,t){return"".concat(e).concat(t[0],",").concat(t[1]," ")},"");return t.setAttributeNS(null,"points",n),t},G=function(e){var t=O.document.createElementNS(P,"path");return t.setAttributeNS(null,"d",e),t},V=function(e,t,n,i,r,a,s,o){var d=[[e,t],[n,i],[r,a],[s,o]].map(function(e){return e.join(",")});return G("M ".concat(d[0]," C ").concat(d[1]," ").concat(d[2]," ").concat(d[3]))},U=function(t,n,i){var r={color:"#000",strokeWidth:.5,width:.5,length:2,bend:.3,pinch:.618,padding:.5,side:!0,start:!1,end:!0,strokeStyle:"",fillStyle:""};"object"===e(i)&&null!==i&&Object.assign(r,i);var a=["stroke:none","fill:".concat(r.color),r.fillStyle].filter(function(e){return""!==e}).join(";"),s=["fill:none","stroke:".concat(r.color),"stroke-width:".concat(r.strokeWidth),r.strokeStyle].filter(function(e){return""!==e}).join(";"),o=t,d=n,l=[d[0]-o[0],d[1]-o[1]],c=[o[0]+l[0]/2,o[1]+l[1]/2],g=C(l[0]*l[0]+l[1]*l[1]),p=2.5*((r.start?1+r.padding:0+r.end?1+r.padding:0)*r.length);if(g<p){var _=[l[0]/g*p,l[1]/g*p];o=[c[0]-.5*_[0],c[1]-.5*_[1]],d=[c[0]+.5*_[0],c[1]+.5*_[1]],l=[d[0]-o[0],d[1]-o[1]]}var f=[l[1],-l[0]],h=[c[0]+f[0]*(r.side?1:-1)*r.bend,c[1]+f[1]*(r.side?1:-1)*r.bend],m=[h[0]-o[0],h[1]-o[1]],u=[h[0]-d[0],h[1]-d[1]],v=C(m[0]*m[0]+m[1]*m[1]),y=C(u[0]*u[0]+u[1]*u[1]),x=[m[0]/v,m[1]/v],b=[u[0]/y,u[1]/y],k=[-x[0],-x[1]],w=[-b[0],-b[1]],A=[k[1],-k[0]],S=[w[1],-w[0]],E=[o[0]+x[0]*r.length*((r.start?1:0)+r.padding),o[1]+x[1]*r.length*((r.start?1:0)+r.padding)],N=[d[0]+b[0]*r.length*((r.end?1:0)+r.padding),d[1]+b[1]*r.length*((r.end?1:0)+r.padding)];l=[N[0]-E[0],N[1]-E[1]],f=[l[1],-l[0]],c=[E[0]+l[0]/2,E[1]+l[1]/2],h=[c[0]+f[0]*(r.side?1:-1)*r.bend,c[1]+f[1]*(r.side?1:-1)*r.bend];var j=[E[0]+(h[0]-E[0])*r.pinch,E[1]+(h[1]-E[1])*r.pinch],z=[N[0]+(h[0]-N[0])*r.pinch,N[1]+(h[1]-N[1])*r.pinch],F=[[E[0]+A[0]*-r.width,E[1]+A[1]*-r.width],[E[0]+A[0]*r.width,E[1]+A[1]*r.width],[E[0]+k[0]*r.length,E[1]+k[1]*r.length]],I=[[N[0]+S[0]*-r.width,N[1]+S[1]*-r.width],[N[0]+S[0]*r.width,N[1]+S[1]*r.width],[N[0]+w[0]*r.length,N[1]+w[1]*r.length]],M=O.document.createElementNS(P,"g"),B=V(E[0],E[1],j[0],j[1],z[0],z[1],N[0],N[1]);if(B.setAttribute("style",s),M.appendChild(B),r.start){var D=X(F);D.setAttribute("style",a),M.appendChild(D)}if(r.end){var q=X(I);q.setAttribute("style",a),M.appendChild(q)}return M},Y=function(e,t){if(!1=="vertices_coords"in e)return[];var n=t&&t.radius?t.radius:.01,i=e.vertices_coords.map(function(e){return W(e[0],e[1],n)});return i.forEach(function(e,t){return e.setAttribute("id","".concat(t))}),i},Z={B:"boundary",b:"boundary",M:"mountain",m:"mountain",V:"valley",v:"valley",F:"mark",f:"mark",U:"unassigned",u:"unassigned"},J={B:"b",b:"b",M:"m",m:"m",V:"v",v:"v",F:"f",f:"f",U:"u",u:"u"},H=function(e){var t=e.vertices_coords,n=e.edges_vertices;return null==n||null==t?[]:n.map(function(e){return e.map(function(e){return t[e]})})},K=function(e){var t=e.edges_assignment,n={b:[],m:[],v:[],f:[],u:[]};return t.map(function(e){return J[e]}).forEach(function(e,t){return n[e].push(t)}),n},Q=function(e){return null==e.edges_vertices||null==e.edges_assignment||e.edges_vertices.length!==e.edges_assignment.length?[]:e.edges_assignment.map(function(e){return Z[e]})},R=function(e){return"M".concat(e[0][0]," ").concat(e[0][1],"L").concat(e[1][0]," ").concat(e[1][1])},$=function(e){return H(e).map(function(e){return R(e)}).join("")},ee=function(e){if(null==e.edges_vertices||null==e.vertices_coords||null==e.edges_assignment)return[];var t=H(e),n=K(e),r=Object.keys(n).map(function(e){return n[e].map(function(e){return t[e]})}).map(function(e){return e.map(function(e){return R(e)}).join("")}),a={};return Object.keys(n).map(function(e,t){""!==r[t]&&(a[e]=r[t])}),a},te=function(e){if(null==e.edges_assignment)return[G($(e))];var t=ee(e);return Object.keys(t).map(function(e){var n=G(t[e]);return n.setAttributeNS(null,"class",Z[e]),n})},ne=function(e){var t=e.map(function(e){return e*e}).reduce(function(e,t){return e+t},0);return C(t)},ie=function(e){var t=ne(e);return 0===t?e:e.map(function(e){return e/t})},re=function(e,t){return e.map(function(n,r){return e[r]*t[r]}).reduce(function(e,t){return e+t},0)},ae=function(e,t){var n=e[0]-t[0],i=e[1]-t[1];return C(n*n+i*i)},se=function(e,t){for(var n=e.length,r=0,a=0;a<n;a+=1)r+=j(e[a]-t[a],2);return C(r)},oe=function(e,t){return e.map(function(n,r){return(e[r]+t[r])/2})},de=Object.freeze({__proto__:null,magnitude:ne,normalize:ie,dot:re,average:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=0<t.length?t[0].length:0,r=Array(i).fill(0);return t.forEach(function(e){return r.forEach(function(t,n){r[n]+=e[n]||0})}),r.map(function(e){return e/t.length})},cross2:function(e,t){return[e[0]*t[1],e[1]*t[0]]},cross3:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[0]*t[2]-e[2]*t[0],e[0]*t[1]-e[1]*t[0]]},distance2:ae,distance3:function(t,n){var i=t[0]-n[0],r=t[1]-n[1],a=t[2]-n[2];return C(i*i+r*r+a*a)},distance:se,midpoint2:oe}),le=function(e){return e[0]*e[3]-e[1]*e[2]},ce=Object.freeze({__proto__:null,multiply_matrix2_vector2:function(e,t){return[e[0]*t[0]+e[2]*t[1]+e[4],e[1]*t[0]+e[3]*t[1]+e[5]]},multiply_matrix2_line2:function(e,t,n){return{origin:[e[0]*t[0]+e[2]*t[1]+e[4],e[1]*t[0]+e[3]*t[1]+e[5]],vector:[e[0]*n[0]+e[2]*n[1],e[1]*n[0]+e[3]*n[1]]}},multiply_matrices2:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},matrix2_determinant:le,invert_matrix2:function(e){var t=le(e);return 1e-6>z(t)||isNaN(t)||!isFinite(e[4])||!isFinite(e[5])?void 0:[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[3]*e[4])/t,(e[1]*e[4]-e[0]*e[5])/t]},make_matrix2_translate:function(e,t){return[1,0,0,1,e,t]},make_matrix2_scale:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0];return[e,0,0,e,e*-t[0]+t[0],e*-t[1]+t[1]]},make_matrix2_rotate:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0],n=N(e),i=E(e);return[n,i,-i,n,t[0],t[1]]},make_matrix2_reflection:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0],n=S(e[1],e[0]),i=N(n),r=E(n),s=N(-n),o=E(-n),l=i*s+r*o,a=i*-o+r*s,g=r*s+-i*o,c=r*-o+-i*s,d=t[0]+l*-t[0]+-t[1]*g,p=t[1]+a*-t[0]+-t[1]*c;return[l,a,g,c,d,p]}}),ge=function(e,t){return[e[0]*t[0]+e[3]*t[1]+e[6]*t[2],e[1]*t[0]+e[4]*t[1]+e[7]*t[2],e[2]*t[0]+e[5]*t[1]+e[8]*t[2],e[0]*t[3]+e[3]*t[4]+e[6]*t[5],e[1]*t[3]+e[4]*t[4]+e[7]*t[5],e[2]*t[3]+e[5]*t[4]+e[8]*t[5],e[0]*t[6]+e[3]*t[7]+e[6]*t[8],e[1]*t[6]+e[4]*t[7]+e[7]*t[8],e[2]*t[6]+e[5]*t[7]+e[8]*t[8],e[0]*t[9]+e[3]*t[10]+e[6]*t[11]+e[9],e[1]*t[9]+e[4]*t[10]+e[7]*t[11]+e[10],e[2]*t[9]+e[5]*t[10]+e[8]*t[11]+e[11]]},pe=function(e){return e[0]*e[4]*e[8]-e[0]*e[7]*e[5]-e[3]*e[1]*e[8]+e[3]*e[7]*e[2]+e[6]*e[1]*e[5]-e[6]*e[4]*e[2]},_e=Object.freeze({__proto__:null,multiply_matrix3_vector3:function(e,t){return[e[0]*t[0]+e[3]*t[1]+e[6]*t[2]+e[9],e[1]*t[0]+e[4]*t[1]+e[7]*t[2]+e[10],e[2]*t[0]+e[5]*t[1]+e[8]*t[2]+e[11]]},multiply_matrix3_line3:function(e,t,n){return{origin:[e[0]*t[0]+e[3]*t[1]+e[6]*t[2]+e[9],e[1]*t[0]+e[4]*t[1]+e[7]*t[2]+e[10],e[2]*t[0]+e[5]*t[1]+e[8]*t[2]+e[11]],vector:[e[0]*n[0]+e[3]*n[1]+e[6]*n[2],e[1]*n[0]+e[4]*n[1]+e[7]*n[2],e[2]*n[0]+e[5]*n[1]+e[8]*n[2]]}},multiply_matrices3:ge,matrix3_determinant:pe,invert_matrix3:function(e){var t=pe(e);if(!(1e-6>z(t))&&!isNaN(t)&&isFinite(e[9])&&isFinite(e[10])&&isFinite(e[11])){var n=[e[4]*e[8]-e[7]*e[5],-e[1]*e[8]+e[7]*e[2],e[1]*e[5]-e[4]*e[2],-e[3]*e[8]+e[6]*e[5],e[0]*e[8]-e[6]*e[2],-e[0]*e[5]+e[3]*e[2],e[3]*e[7]-e[6]*e[4],-e[0]*e[7]+e[6]*e[1],e[0]*e[4]-e[3]*e[1],-e[3]*e[7]*e[11]+e[3]*e[8]*e[10]+e[6]*e[4]*e[11]-e[6]*e[5]*e[10]-e[9]*e[4]*e[8]+e[9]*e[5]*e[7],e[0]*e[7]*e[11]-e[0]*e[8]*e[10]-e[6]*e[1]*e[11]+e[6]*e[2]*e[10]+e[9]*e[1]*e[8]-e[9]*e[2]*e[7],-e[0]*e[4]*e[11]+e[0]*e[5]*e[10]+e[3]*e[1]*e[11]-e[3]*e[2]*e[10]-e[9]*e[1]*e[5]+e[9]*e[2]*e[4]];return n.map(function(e){return e*(1/t)})}},make_matrix3_translate:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return[1,0,0,0,1,0,0,0,1,e,t,n]},make_matrix3_rotateX:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=N(e),i=E(e);return[1,0,0,0,n,i,0,-i,n,t[0]||0,t[1]||0,t[2]||0]},make_matrix3_rotateY:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=N(e),i=E(e);return[n,0,-i,0,1,0,i,0,n,t[0]||0,t[1]||0,t[2]||0]},make_matrix3_rotateZ:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=N(e),i=E(e);return[n,i,0,-i,n,0,0,0,1,t[0]||0,t[1]||0,t[2]||0]},make_matrix3_rotate:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[0,0,0],s=ie(n),o=Array.from([,,,]).map(function(e,t){return r[t]||0}),l=g(s,3),p=l[0],i=l[1],a=l[2],c=N(e),_=E(e),f=C(s[1]*s[1]+s[2]*s[2]),d=1e-6>z(f)?0:i/f,h=1e-6>z(f)?1:a/f,m=[1,0,0,0,1,0,0,0,1,o[0],o[1],o[2]],t=[1,0,0,0,1,0,0,0,1,-o[0],-o[1],-o[2]];return ge(t,ge([1,0,0,0,h,-d,0,d,h,0,0,0],ge([f,0,-p,0,1,0,p,0,f,0,0,0],ge([c,_,0,-_,c,0,0,0,1,0,0,0],ge([f,0,p,0,1,0,-p,0,f,0,0,0],ge([1,0,0,0,h,d,0,-d,h,0,0,0],m))))))},make_matrix3_scale:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,0];return[e,0,0,0,e,0,0,0,e,e*-t[0]+t[0],e*-t[1]+t[1],e*-t[2]+t[2]]},make_matrix3_reflectionZ:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0],n=S(e[1],e[0]),i=N(n),r=E(n),s=N(-n),o=E(-n),l=i*s+r*o,a=i*-o+r*s,g=r*s+-i*o,c=r*-o+-i*s,d=t[0]+l*-t[0]+-t[1]*g,p=t[1]+a*-t[0]+-t[1]*c;return[l,a,0,g,c,0,0,0,0,d,p,0]}}),fe=function(e){var t=Math.max,n="".concat(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return n?t(0,(n[1]?n[1].length:0)-(n[2]?+n[2]:0)):0},he=function(e){var t=Math.min,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:15,i=parseFloat(e.toFixed(n));return fe(i)===t(n,fe(e))?e:i},me=function(e){return null!=e&&"function"==typeof e[Symbol.iterator]},ue=function e(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];switch(n.length){case void 0:case 0:return n;case 1:return me(n[0])&&"string"!=typeof n[0]?e.apply(void 0,p(n[0])):[n[0]];default:return Array.from(n).map(function(t){return me(t)?p(e(t)):t}).reduce(function(e,t){return e.concat(t)},[]);}},ve=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=t;1===i.length&&i[0].length;){var r=i,a=g(r,1);i=a[0]}return i},ye=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=ue(t).filter(function(e){return void 0!==e});if(void 0!==i)return 0===i.length?void 0:(isNaN(i[0].x)||(i=["x","y","z"].map(function(e){return i[0][e]}).filter(function(e){return void 0!==e})),i.filter(function(e){return"number"==typeof e}))},xe=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return ve(t).map(function(e){return ye(e)})},be=[1,0,0,1,0,0],ke=1e-6,we=function(e,t){return Array.from(Array(e.length-1)).map(function(n,r){return t(e[0],e[r+1])}).reduce(function(e,t){return e&&t},!0)},Ae=function e(){var t=xe.apply(void 0,arguments);if(0===t.length)return!1;if(1===t.length&&void 0!==t[0])return e.apply(void 0,p(t[0]));var n=t[0].length,r=Array.from(Array(n));return Array.from(Array(t.length-1)).map(function(e,n){return r.map(function(e,i){return z(t[n][i]-t[n+1][i])<ke}).reduce(function(e,t){return e&&t},!0)}).reduce(function(e,t){return e&&t},!0)&&Array.from(Array(t.length-1)).map(function(e,n){return t[0].length===t[n+1].length}).reduce(function(e,t){return e&&t},!0)},Se=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=ve(t);if(1>i.length)return!1;var r=l(i[0]);if("undefined"===r)return!1;switch(i[0].constructor===Array&&(i=i.map(function(e){return ve(e)})),r){case"number":return we(i,function(e,t){return z(e-t)<ke});case"boolean":return we(i,function(e,t){return e===t});case"string":return we(i,function(e,t){return e===t});case"object":return i[0].constructor===Array?Ae.apply(void 0,p(i)):(console.warn("comparing array of objects for equivalency by slow JSON.stringify with no epsilon check"),we(i,function(e,t){return JSON.stringify(e)===JSON.stringify(t)}));default:console.warn("incapable of determining comparison method");}return!1},Ee=Object.freeze({__proto__:null,EPSILON:ke,equivalent_numbers:function e(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return 0!==n.length&&(1===n.length&&void 0!==n[0]?e.apply(void 0,p(n[0])):we(n,function(e,t){return z(e-t)<ke}))},equivalent_vectors:Ae,equivalent:Se}),Ne=function(e,t,n,i,r){var a=function(e,t){return e[0]*t[1]-t[0]*e[1]},s=a(t,i),o=a([n[0]-e[0],n[1]-e[1]],i),d=a([e[0]-n[0],e[1]-n[1]],t);if(z(s)<ke)return!1;return r(o/s,d/-s)},je=function(e,t){return e>=-ke&&e<=1+ke&&t>=-ke&&t<=1+ke},Ce=function(e,t,n,i){var r=[t[0]-e[0],t[1]-e[1]],a=[i[0]-n[0],i[1]-n[1]];return Ne(e,r,n,a,je)},ze=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ke,r=[n[0]-e[0],n[1]-e[1]],a=r[0]*t[1]-r[1]*t[0];return z(a)<i},Fe=function(e,t){for(var n=!1,r=0,a=t.length-1;r<t.length;a=r++)t[r][1]>e[1]!=t[a][1]>e[1]&&e[0]<(t[a][0]-t[r][0])*(e[1]-t[r][1])/(t[a][1]-t[r][1])+t[r][0]&&(n=!n);return n},Ie=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:ke;return!!(null!=t&&0<t.length)&&t.map(function(t,r,i){var s=i[(r+1)%i.length],o=[s[0]-t[0],s[1]-t[1]],a=[e[0]-t[0],e[1]-t[1]];return o[0]*a[1]-o[1]*a[0]>-n}).map(function(e,t,n){return e===n[0]}).reduce(function(e,t){return e&&t},!0)},Me=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:ke;return!!(null!=t&&0<t.length)&&t.map(function(t,r,i){var s=i[(r+1)%i.length],o=[s[0]-t[0],s[1]-t[1]],a=[e[0]-t[0],e[1]-t[1]];return o[0]*a[1]-o[1]*a[0]>n}).map(function(e,t,n){return e===n[0]}).reduce(function(e,t){return e&&t},!0)},Oe=Object.freeze({__proto__:null,overlap_function:Ne,segment_segment_overlap:Ce,degenerate:function(e){return z(e.reduce(function(e,t){return e+t},0))<ke},parallel:function(e,t){return 1-z(re(ie(e),ie(t)))<ke},point_on_line:ze,point_on_segment:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ke,r=[e[0]-t[0],e[1]-t[1]],a=[e[0]-n[0],e[1]-n[1]],s=[t[0]-n[0],t[1]-n[1]],o=C(r[0]*r[0]+r[1]*r[1]),d=C(a[0]*a[0]+a[1]*a[1]),l=C(s[0]*s[0]+s[1]*s[1]);return z(o-d-l)<i},point_in_poly:Fe,point_in_convex_poly:Ie,point_in_convex_poly_exclusive:Me,convex_polygons_overlap:function(e,t){for(var n=e.map(function(e,t,n){return[e,n[(t+1)%n.length]]}),r=t.map(function(e,t,n){return[e,n[(t+1)%n.length]]}),a=0;a<n.length;a+=1)for(var s=0;s<r.length;s+=1)if(Ce(n[a][0],n[a][1],r[s][0],r[s][1]))return!0;return!!Fe(t[0],e)||!!Fe(e[0],t)},convex_polygon_is_enclosed:function(e,t){var n=t.map(function(t){return Ie(t,e)}).reduce(function(e,t){return e||t},!1);return!n&&void 0},convex_polygons_enclose:function(e,t){var n=t.map(function(t){return Ie(t,e)}).reduce(function(e,t){return e||t},!1),i=e.map(function(t){return Ie(t,e)}).reduce(function(e,t){return e&&t},!0);return!n&&i},is_counter_clockwise_between:function(e,t,n){for(;n<t;)n+=2*A;for(;e<t;)e+=2*A;return e<n}}),Pe=function(){return!0},Be=function(e,t){return t>=-ke},De=function(e,t){return t>=-ke&&t<=1+ke},qe=function(e,t){return e>=-ke&&t>=-ke},Le=function(e,t){return e>=-ke&&t>=-ke&&t<=1+ke},Te=function(e,t){return e>=-ke&&e<=1+ke&&t>=-ke&&t<=1+ke},We=function(e,t){return t>ke},Xe=function(e,t){return t>ke&&t<1-ke},Ge=function(e,t){return e>ke&&t>ke},Ve=function(e,t){return e>ke&&t>ke&&t<1-ke},Ue=function(e,t){return e>ke&&e<1-ke&&t>ke&&t<1-ke},Ye=function(e,t,n,i,r){function a(e,t){return e[0]*t[1]-t[0]*e[1]}var s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:ke,o=a(t,i);if(!(z(o)<s)){var d=a([n[0]-e[0],n[1]-e[1]],i),l=a([e[0]-n[0],e[1]-n[1]],t),c=d/o;return r(c,l/-o,s)?[e[0]+t[0]*c,e[1]+t[1]*c]:void 0}},Ze=function(e,t,n,i,r){var a=[i[0]-n[0],i[1]-n[1]];return Ye(e,t,n,a,De,r)},Je=function(e,t,n,i,r){var a=[i[0]-n[0],i[1]-n[1]];return Ye(e,t,n,a,Le,r)},He=function(e,t,n,i,r){var a=[i[0]-n[0],i[1]-n[1]];return Ye(e,t,n,a,Xe,r)},Ke=function(e,t,n,i,r){var a=[i[0]-n[0],i[1]-n[1]];return Ye(e,t,n,a,Ve,r)},Qe=function(e,t,n,i,r){var a=[t[0]-e[0],t[1]-e[1]],s=[i[0]-n[0],i[1]-n[1]];return Ye(e,a,n,s,Ue,r)},Re=function(e,t){return z(e[0]-t[0])<ke&&z(e[1]-t[1])<ke},$e=Object.freeze({__proto__:null,limit_line:function(e){return e},limit_ray:function(e){return e<-ke?0:e},limit_segment:function(e){return e<-ke?0:e>1+ke?1:e},intersection_function:Ye,line_line:function(e,t,n,i,r){return Ye(e,t,n,i,Pe,r)},line_ray:function(e,t,n,i,r){return Ye(e,t,n,i,Be,r)},line_segment:Ze,ray_ray:function(e,t,n,i,r){return Ye(e,t,n,i,qe,r)},ray_segment:Je,segment_segment:function(e,t,n,i,r){var a=[t[0]-e[0],t[1]-e[1]],s=[i[0]-n[0],i[1]-n[1]];return Ye(e,a,n,s,Te,r)},line_ray_exclusive:function(e,t,n,i,r){return Ye(e,t,n,i,We,r)},line_segment_exclusive:He,ray_ray_exclusive:function(e,t,n,i,r){return Ye(e,t,n,i,Ge,r)},ray_segment_exclusive:Ke,segment_segment_exclusive:Qe,circle_line:function(e,t,n,i){function r(e){return e<-a?-1:1}var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ke,s=n[0]-e[0],o=n[1]-e[1],d=i[0]-e[0],l=i[1]-e[1],c=d-s,g=l-o,p=s*l-d*o,_=p*p,f=t*t,h=z(c*c+g*g),m=f*h-_;if(!(m<-a)){var u=C(f*h-_),v=[e[0]+(p*g+r(g)*c*u)/h,e[1]+(-p*c+z(g)*u)/h];if(m>a){var y=[e[0]+(p*g-r(g)*c*u)/h,e[1]+(-p*c-z(g)*u)/h];return[v,y]}return[v]}},circle_ray:function(){throw"circle_ray has not been written yet"},circle_segment:function(e,t,n,i){function r(e){return 0>e?-1:1}var a=j(t,2),s=n[0]-e[0],o=n[1]-e[1],d=i[0]-e[0],l=i[1]-e[1],c=d-s,g=l-o,p=c*c+g*g,_=s*l-d*o,f=(_*g+r(g)*c*C(a*p-_*_))/p,h=(_*g-r(g)*c*C(a*p-_*_))/p,m=(-_*c+z(g)*C(a*p-_*_))/p,u=(-_*c-z(g)*C(a*p-_*_))/p,v=isNaN(f),y=isNaN(h);return v||y?v&&y?void 0:v?y?void 0:[[h+e[0],u+e[1]]]:[[f+e[0],m+e[1]]]:[[f+e[0],m+e[1]],[h+e[0],u+e[1]]]},convex_poly_line:function(e,t,n){var r=e.map(function(e,t,n){return[e,n[(t+1)%n.length]]}).map(function(e){return Ze(t,n,e[0],e[1])}).filter(function(e){return null!=e});switch(r.length){case 0:return;case 1:return[r[0],r[0]];case 2:return r;default:for(var a=1;a<r.length;a+=1)if(!Re(r[0],r[a]))return[r[0],r[a]];}},convex_poly_ray:function(e,t,n){var r=e.map(function(e,t,n){return[e,n[(t+1)%n.length]]}).map(function(e){return Je(t,n,e[0],e[1])}).filter(function(e){return null!=e});switch(r.length){case 0:return;case 1:return[t,r[0]];case 2:return r;default:for(var a=1;a<r.length;a+=1)if(!Re(r[0],r[a]))return[r[0],r[a]];}},convex_poly_segment:function(e,t,n){var i=e.map(function(e,t,n){return[e,n[(t+1)%n.length]]}).map(function(e){return Qe(t,n,e[0],e[1])}).filter(function(e){return null!=e}),r=Me(t,e),a=Me(n,e),s=Ie(t,e),o=Ie(n,e);if(0===i.length&&(r||a))return[t,n];if(0===i.length&&s&&o)return[t,n];switch(i.length){case 0:return r?[p(t),p(n)]:void 0;case 1:return s?[p(t),i[0]]:[p(n),i[0]];case 2:return i;default:throw new Error("clipping segment in a convex polygon resulting in 3 or more points");}},convex_poly_ray_exclusive:function(e,t,n){var r=e.map(function(e,t,n){return[e,n[(t+1)%n.length]]}).map(function(e){return Ke(t,n,e[0],e[1])}).filter(function(e){return null!=e});switch(r.length){case 0:return;case 1:return[t,r[0]];case 2:return r;default:for(var a=1;a<r.length;a+=1)if(!Re(r[0],r[a]))return[r[0],r[a]];}}}),et=function(e,t){var n=e[0]*t[0]+e[1]*t[1],i=e[0]*t[1]-e[1]*t[0],r=S(i,n);return 0>r&&(r+=2*A),r},tt=function(e,t){var n=ie(e),r=ie(t),i=n.map(function(e,t){return n[t]+r[t]}),a=ie(i),s=n.map(function(e,t){return-n[t]+-r[t]});return[a,ie(s)]},nt=function(e,t,n){var r=et(t,n)/e;return Array.from(Array(e-1)).map(function(e,n){return t+r*n})},it=function(e){return .5*e.map(function(e,t,n){var i=n[(t+1)%n.length];return e[0]*i[1]-i[0]*e[1]}).reduce(function(e,t){return e+t},0)},rt=function(e,t,n){for(var r,a=t.map(function(t,r){return{o:t,i:r,d:n(e,t)}}),s=1/0,o=0;o<a.length;o+=1)a[o].d<s&&(r=o,s=a[o].d);return r},at=function(e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:ke,n=e.slice().sort(function(e,n){return z(e[1]-n[1])<t?e[0]-n[0]:e[1]-n[1]}),i=[];i.push(n[0]);var r=0,a=0,s=function(){a+=1;var e=i.length-1,s=n.filter(function(n){return!(z(n[0]-i[e][0])<t&&z(n[1]-i[e][1])<t)}).map(function(t){for(var n=S(i[e][1]-t[1],i[e][0]-t[0]);n<r;)n+=2*A;return{node:t,angle:n,distance:void 0}}).sort(function(e,t){return e.angle<t.angle?-1:e.angle>t.angle?1:0});if(0===s.length)return{v:void 0};var o=s[0];return s=s.filter(function(e){return z(o.angle-e.angle)<t}).map(function(t){var n=C(j(i[e][0]-t.node[0],2)+j(i[e][1]-t.node[1],2));return t.distance=n,t}).sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0}),0<i.filter(function(e){return e===s[0].node}).length?{v:i}:void(i.push(s[0].node),r=S(i[e][1]-s[0].node[1],i[e][0]-s[0].node[0]))};do{var o=s();if("object"===l(o))return o.v}while(a<1e4)},st=Object.freeze({__proto__:null,clockwise_angle2_radians:function(e,t){for(;0>e;)e+=2*A;for(;0>t;)t+=2*A;var n=e-t;return 0<=n?n:2*A-(t-e)},counter_clockwise_angle2_radians:function(e,t){for(;0>e;)e+=2*A;for(;0>t;)t+=2*A;var n=t-e;return 0<=n?n:2*A-(e-t)},clockwise_angle2:function(e,t){var n=t[0]*e[0]+t[1]*e[1],i=t[0]*e[1]-t[1]*e[0],r=S(i,n);return 0>r&&(r+=2*A),r},counter_clockwise_angle2:et,counter_clockwise_vector_order:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.map(function(e){return S(e[1],e[0])}),r=Array.from(Array(i.length)).map(function(e,t){return t}).sort(function(e,t){return i[e]-i[t]});return r.slice(r.indexOf(0),r.length).concat(r.slice(0,r.indexOf(0)))},interior_angles2:function(e,t){var n=et(e,t);return[n,2*A-n]},interior_angles:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(function(e,t,n){return et(e,n[(t+1)%n.length])})},bisect_vectors:tt,bisect_lines2:function(e,n,i,r){var a=n[0]*r[1]-r[0]*n[1];if(z(a)<ke){var s=[oe(e,i),[n[0],n[1]]],o=[s,s],d=n[0]*r[0]+n[1]*r[1];return delete o[0<d?1:0],o}var l=(i[0]-e[0])*r[1]-r[0]*(i[1]-e[1]),c=l/a,t=e[0]+n[0]*c,g=e[1]+n[1]*c,p=tt(n,r);return p[1]=[p[1][1],-p[1][0]],p.map(function(e){return[[t,g],e]})},subsect_radians:nt,subsect:function(e,t,n){var i=S(t[1],t[0]),r=S(n[1],n[0]);return nt(e,i,r).map(function(e){return[N(e),E(e)]})},signed_area:it,centroid:function(e){var t=1/(6*it(e));return e.map(function(e,t,n){var i=n[(t+1)%n.length],r=e[0]*i[1]-i[0]*e[1];return[(e[0]+i[0])*r,(e[1]+i[1])*r]}).reduce(function(e,t){return[e[0]+t[0],e[1]+t[1]]},[0,0]).map(function(e){return e*t})},enclosing_rectangle:function(e){var t=e[0].length,n=Array.from(Array(t)).map(function(){return 1/0}),r=Array.from(Array(t)).map(function(){return-Infinity});e.forEach(function(e){return e.forEach(function(e,t){e<n[t]&&(n[t]=e),e>r[t]&&(r[t]=e)})});var a=r.map(function(e,t){return e-n[t]});return[n,a]},make_regular_polygon:function(e){var t=Math.floor,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=.5*(2*A/e),d=i/N(o);return Array.from(Array(t(e))).map(function(t,r){var i=-2*A*r/e+o,a=he(n+d*E(i),14),l=he(s+d*N(i),14);return[a,l]})},nearest_point2:function(e,t){var n=rt(e,t,ae);return void 0===n?void 0:t[n]},nearest_point:function(e,t){var n=rt(e,t,se);return void 0===n?void 0:t[n]},nearest_point_on_line:function(e,t,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ke,a=j(t[0],2)+j(t[1],2),s=[0,1].map(function(t,r){return n[r]-e[r]}),o=[0,1].map(function(e,n){return t[n]*s[n]}).reduce(function(e,t){return e+t},0),l=i(o/a,r);return[0,1].map(function(n,r){return e[r]+t[r]*l})},split_polygon:function(e,t,n){var i=e.map(function(e,r){var i=ze(t,n,e);return{type:"v",point:i?e:null,at_index:r}}).filter(function(e){return null!=e.point}),r=e.map(function(e,r,i){var a=He(t,n,e,i[(r+1)%i.length]);return{type:"e",point:a,at_index:r}}).filter(function(e){return null!=e.point}),a=i.concat(r).sort(function(e,t){return z(e.point[0]-t.point[0])<ke?e.point[1]-t.point[1]:e.point[0]-t.point[0]});return console.log(a),e},split_convex_polygon:function(e,t,n){var i=e.map(function(e,r){var i=ze(t,n,e);return{point:i?e:null,at_index:r}}).filter(function(e){return null!=e.point}),r=e.map(function(e,r,i){var a=He(t,n,e,i[(r+1)%i.length]);return{point:a,at_index:r}}).filter(function(e){return null!=e.point});if(2==r.length){var a=r.slice().sort(function(e,t){return e.at_index-t.at_index}),s=e.slice(a[1].at_index+1).concat(e.slice(0,a[0].at_index+1));s.push(a[0].point),s.push(a[1].point);var o=e.slice(a[0].at_index+1,a[1].at_index+1);return o.push(a[1].point),o.push(a[0].point),[s,o]}if(1==r.length&&1==i.length){i[0].type="v",r[0].type="e";var d=i.concat(r).sort(function(e,t){return e.at_index-t.at_index}),l=e.slice(d[1].at_index+1).concat(e.slice(0,d[0].at_index+1));"e"===d[0].type&&l.push(d[0].point),l.push(d[1].point);var c=e.slice(d[0].at_index+1,d[1].at_index+1);return"e"===d[1].type&&c.push(d[1].point),c.push(d[0].point),[l,c]}if(2==i.length){var g=i.slice().sort(function(e,t){return e.at_index-t.at_index}),p=e.slice(g[1].at_index).concat(e.slice(0,g[0].at_index+1)),_=e.slice(g[0].at_index,g[1].at_index+1);return[p,_]}return[e.slice()]},convex_hull:at}),ot=Object.create(null);Object.assign(ot,de,ce,_e,st,Oe,Ee),ot.clean_number=he,ot.is_number=function(e){return null!=e&&!isNaN(e)},ot.is_vector=function(e){return null!=e&&null!=e[0]&&!isNaN(e[0])},ot.is_iterable=me,ot.flatten_input=ue,ot.semi_flatten_input=ve,ot.get_vector=ye,ot.get_vector_of_vectors=xe,ot.get_matrix2=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=ye(t);return void 0===r?void 0:6===r.length?r:6<r.length?[r[0],r[1],r[2],r[3],r[4],r[5]]:6>r.length?be.map(function(e,t){return r[t]||e}):void 0},ot.get_segment=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return xe(t)},ot.get_line=y,ot.get_ray=function(){return y.apply(void 0,arguments)},ot.get_two_vec2=x,ot.get_array_of_vec=b,ot.get_array_of_vec2=function(){var e=Array.from(arguments),t=e.filter(function(e){return e.constructor===Array});return 2<=t.length&&!isNaN(t[0][0])?t:1===t.length&&1<=t[0].length?t[0]:e},ot.intersection=$e,Object.freeze(ot);var dt=function(e){var t=e.edges_vertices;if(t){var n=[];return t.forEach(function(e,t){return e.forEach(function(e){void 0===n[e]&&(n[e]=[]),n[e].push(t)})}),n}},lt=function(e){var t=e.faces_vertices;if(t){var n=t.length,i=Array.from(Array(n)).map(function(){return[]}),r={};return t.forEach(function(e,t){if(void 0!==e){var a=e.length;e.forEach(function(e,n,s){var o=s[(n+1)%a];if(o<e){var d=[o,e];e=d[0],o=d[1]}var l="".concat(e," ").concat(o);if(l in r){var c=r[l];i[t].push(c),i[c].push(t)}else r[l]=t})}}),i}},ct=function(e){var t=e.edges_vertices;if(!t)return{};var n={};return t.map(function(e){return e.sort(function(e,t){return e-t}).join(" ")}).forEach(function(e,t){n[e]=t}),n},gt=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=ct(e),i=lt(e);if(0>=i.length)return[];var r=[t],a=[[{face:t,parent:void 0,edge:void 0,level:0}]];do a[a.length]=a[a.length-1].map(function(t){var a=i[t.face].filter(function(e){return-1===r.indexOf(e)});return r=r.concat(a),a.map(function(i){var r=e.faces_vertices[i].filter(function(n){return-1!==e.faces_vertices[t.face].indexOf(n)}).sort(function(e,t){return e-t}),a=n[r.join(" ")];return{face:i,parent:t.face,edge:a,edge_vertices:r}})}).reduce(function(e,t){return e.concat(t)},[]);while(0<a[a.length-1].length);return 0<a.length&&0===a[a.length-1].length&&a.pop(),a},pt=function(e){return e.map(function(e){return e[0]*e[3]-e[1]*e[2]}).map(function(e){return 0<=e})},_t=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=[];return n[t]=!0,gt(e,t).forEach(function(e,t){return e.forEach(function(e){n[e.face]=0==t%2})}),n},ft=function(e){return e.map(function(e,t){return{layer:e,i:t}}).sort(function(e,t){return e.layer-t.layer}).map(function(e){return e.i})},ht=function(e){var t=e["faces_re:coloring"];return null==t&&(t="faces_re:matrix"in e?pt(e["faces_re:matrix"]):_t(e,0)),t.map(function(e){return e?"front":"back"})},mt=function(e,t){var n=null!=e["faces_re:layer"]&&e["faces_re:layer"].length===e.faces_vertices.length;return n&&ht(e).forEach(function(e,n){return t[n].setAttribute("class",e)}),n?ft(e["faces_re:layer"]).map(function(e){return t[e]}):t},ut=function(e){if(!1=="faces_vertices"in e||!1=="vertices_coords"in e)return[];var t=e.faces_vertices.map(function(t){return t.map(function(t){return e.vertices_coords[t]})}).map(function(e){return X(e)});return t.forEach(function(e,t){return e.setAttribute("id","".concat(t))}),mt(e,t)},vt=function(e){if(!1=="faces_edges"in e||!1=="edges_vertices"in e||!1=="vertices_coords"in e)return[];var t=e.faces_edges.map(function(t){return t.map(function(t){return e.edges_vertices[t]}).map(function(e,t,n){var i=n[(t+1)%n.length];return e[1]===i[0]||e[1]===i[1]?e[0]:e[1]}).map(function(t){return e.vertices_coords[t]})}).map(function(e){return X(e)});return t.forEach(function(e,t){return e.setAttribute("id","".concat(t))}),mt(e,t)},yt=O.document,xt="http://www.w3.org/2000/svg",bt=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"shadow",t=yt.createElementNS(xt,"defs"),n=yt.createElementNS(xt,"filter");n.setAttribute("width","200%"),n.setAttribute("height","200%"),n.setAttribute("id",e);var i=yt.createElementNS(xt,"feGaussianBlur");i.setAttribute("in","SourceAlpha"),i.setAttribute("stdDeviation","0.005"),i.setAttribute("result","blur");var r=yt.createElementNS(xt,"feOffset");r.setAttribute("in","blur"),r.setAttribute("result","offsetBlur");var a=yt.createElementNS(xt,"feFlood");a.setAttribute("flood-color","#000"),a.setAttribute("flood-opacity","0.3"),a.setAttribute("result","offsetColor");var s=yt.createElementNS(xt,"feComposite");s.setAttribute("in","offsetColor"),s.setAttribute("in2","offsetBlur"),s.setAttribute("operator","in"),s.setAttribute("result","offsetBlur");var o=yt.createElementNS(xt,"feMerge"),d=yt.createElementNS(xt,"feMergeNode"),l=yt.createElementNS(xt,"feMergeNode");return l.setAttribute("in","SourceGraphic"),o.appendChild(d),o.appendChild(l),t.appendChild(n),n.appendChild(i),n.appendChild(r),n.appendChild(a),n.appendChild(s),n.appendChild(o),t},kt=function(e){var t=e.vertices_coords;if(null==t||0>=t.length)return[0,0,0,0];var n=t[0].length,r=Array(n).fill(1/0),a=Array(n).fill(-Infinity);return t.forEach(function(e){return e.forEach(function(e,t){e<r[t]&&(r[t]=e),e>a[t]&&(a[t]=e)})}),isNaN(r[0])||isNaN(r[1])||isNaN(a[0])||isNaN(a[1])?[0,0,0,0]:[r[0],r[1],a[0]-r[0],a[1]-r[1]]},wt=function(e){if(null==e.edges_assignment)return{vertices:[],edges:[]};for(var n=e.edges_assignment.map(function(e){return"B"===e||"b"===e}),r=dt(e),a=[],s=[],o=-1,d=0;d<n.length;d+=1)if(n[d]){o=d;break}if(-1===o)return{vertices:[],edges:[]};n[o]=!1,a.push(o),s.push(e.edges_vertices[o][0]);for(var l=e.edges_vertices[o][1];s[0]!==l;){if(s.push(l),o=r[l].filter(function(e){return n[e]}).shift(),void 0===o)return{vertices:[],edges:[]};if(e.edges_vertices[o][0]===l){var c=t(e.edges_vertices[o],2);l=c[1]}else{var g=t(e.edges_vertices[o],1);l=g[0]}n[o]=!1,a.push(o)}return{vertices:s,edges:a}},At=function(e){if(!1=="vertices_coords"in e||!1=="edges_vertices"in e||!1=="edges_assignment"in e)return[];var t=wt(e).vertices.map(function(t){return e.vertices_coords[t]}),n=X(t);return n.setAttribute("class","boundary"),[n]},St=function t(n){var r,a;if("object"!==e(n))return n;if(!n)return n;if("[object Array]"===Object.prototype.toString.apply(n)){for(r=[],a=0;a<n.length;a+=1)r[a]=t(n[a]);return r}for(a in r={},n)n.hasOwnProperty(a)&&(r[a]=t(n[a]));return r},Et=function(e,t){if(!1=="file_frames"in e||e.file_frames.length<t)return e;var n=["frame_parent","frame_inherit"],i={visited_frames:[]};return function e(t,n,r){if(-1!==i.visited_frames.indexOf(n))throw new Error("encountered a cycle in file_frames. can't flatten.");return i.visited_frames.push(n),r=[n].concat(r),0===n?r:t.file_frames[n-1].frame_inherit&&null!=t.file_frames[n-1].frame_parent?e(t,t.file_frames[n-1].frame_parent,r):r}(e,t,[]).map(function(t){if(0===t){var i=e.file_frames;e.file_frames=null;var r=St(e);return e.file_frames=i,delete r.file_frames,n.forEach(function(e){return delete r[e]}),r}var a=St(e.file_frames[t-1]);return n.forEach(function(e){return delete a[e]}),a}).reduce(function(e,t){return Object.assign(e,t)},{})},Nt={vertices:"vertices",edges:"creases",faces:"faces",boundaries:"boundaries"},jt=function(e){return!0=="faces_vertices"in e?ut(e):!0=="faces_edges"in e?vt(e):[]},Ct={vertices:Y,edges:te,faces:jt,boundaries:At},zt=function(e){var t=(null==e.file_classes?[]:e.file_classes).join(" "),n=(null==e.frame_classes?[]:e.frame_classes).join(" ");return[t,n].filter(function(e){return""!==e}).join(" ")},Ft=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:14;return parseFloat(e.toFixed(t))},It=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=e;null!=i.vertices_coords&&(i.vertices_coordsPreClean=i.vertices_coords,i.vertices_coords=JSON.parse(JSON.stringify(i.vertices_coords)).map(function(e){return e.map(function(e){return Ft(e)})}));var r={defaults:!0,width:"500px",height:"500px",inlineStyle:!0,stylesheet:"svg * {\n  stroke-width: var(--crease-width);\n  stroke-linecap: round;\n  stroke: black;\n}\n.mountain { stroke: red; }\n.mark { stroke: lightgray; }\n.valley { stroke: blue;\n  stroke-dasharray: calc(var(--crease-width) * 2) calc(var(--crease-width) * 2);\n}\npolygon { stroke: none; stroke-linejoin: bevel; }\n.foldedForm polygon { stroke: black; fill: #8881; }\n.foldedForm polygon.front { fill: white; }\n.foldedForm polygon.back { fill: lightgray; }\n.creasePattern polygon { fill: white; stroke: none; }\n.foldedForm .boundaries polygon { fill: none; stroke: none; }\n.foldedForm path, .foldedForm line { stroke: none; }\n",shadows:!1,padding:0,viewBox:null,diagram:!0,boundaries:!0,faces:!0,edges:!0,vertices:!1};Object.assign(r,t),null!=r.frame&&(i=Et(e,r.frame)),null==r.svg&&(r.svg=B()),r.svg.setAttribute("class",zt(i)),r.svg.setAttribute("width",r.width),r.svg.setAttribute("height",r.height);var a=q();r.svg.appendChild(a);var s={};if(["boundaries","faces","edges","vertices"].filter(function(e){return r[e]}).forEach(function(e){s[e]=D(),s[e].setAttribute("class",Nt[e]),r.svg.appendChild(s[e])}),Object.keys(s).forEach(function(e){return Ct[e](i).forEach(function(t){return s[e].appendChild(t)})}),"re:diagrams"in i&&r.diagram){var o=D();r.svg.appendChild(o),w(i,o)}if(r.shadows){var d=bt("face_shadow");r.svg.appendChild(d),Array.from(s.faces.childNodes).forEach(function(e){return e.setAttribute("filter","url(#".concat("face_shadow",")"))})}var l=kt(i);if(null==r.viewBox?L.apply(void 0,[r.svg].concat(n(l),[r.padding])):L.apply(void 0,[r.svg].concat(n(r.viewBox),[r.padding])),null!=i.vertices_coordsPreClean&&(i.vertices_coords=i.vertices_coordsPreClean,delete i.vertices_coordsPreClean),r.inlineStyle){var c=l[2]>l[3]?l[3]:l[2],g="\nsvg { --crease-width: ".concat(.005*c,"; }\n").concat(r.stylesheet),p=new O.DOMParser().parseFromString("<xml></xml>","application/xml"),_=p.createCDATASection(g);a.appendChild(_)}var f=new O.XMLSerializer().serializeToString(r.svg),h=k(f);return h},Mt=function(t){if(null==t)return{};if("object"===e(t)&&null!==t)return t;if("string"==typeof t||t instanceof String)try{var n=JSON.parse(t);return n}catch(e){throw e}throw new TypeError("couldn't recognize input. looking for string or object")},Ot=function(e,t){try{var n=Mt(e);return It(n,t)}catch(e){throw e}};return Ot.vertices_circle=Y,Ot.edges_path_data=$,Ot.edges_by_assignment_paths_data=ee,Ot.edges_path=te,Ot.edges_line=function(e){var t=H(e).map(function(t){return T(t[0][0],t[0][1],t[1][0],t[1][1])});return t.forEach(function(e,t){return e.setAttributeNS(null,"index",t)}),Q(e).forEach(function(e,n){return t[n].setAttributeNS(null,"class",e)}),t},Ot.faces_vertices_polygon=ut,Ot.faces_edges_polygon=vt,Ot});
