/* (c) Robby Kraft, MIT License */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.FoldToSvg=b())})(this,function(){'use strict';function a(b){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){return e(a)||g(a,b)||j()}function c(a){return d(a)||f(a)||h()}function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function e(a){if(Array.isArray(a))return a}function f(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function g(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function k(a,b){for(var c=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),d=c.length,e=!1,f=0,g="",h=null!=b&&"string"==typeof b?b:"\t",i=["\n"],j=0;100>j;j+=1)i.push(i[j]+h);for(var k=0;k<d;k+=1)-1<c[k].search(/<!/)?(g+=i[f]+c[k],e=!0,(-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)||-1<c[k].search(/!DOCTYPE/))&&(e=!1)):-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)?(g+=c[k],e=!1):/^<\w/.exec(c[k-1])&&/^<\/\w/.exec(c[k])&&/^<[\w:\-\.\,]+/.exec(c[k-1])==/^<\/[\w:\-\.\,]+/.exec(c[k])[0].replace("/","")?(g+=c[k],e||(f-=1)):-1<c[k].search(/<\w/)&&-1===c[k].search(/<\//)&&-1===c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f++]+c[k]:-1<c[k].search(/<\w/)&&-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[f]+c[k]:-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[--f]+c[k]:-1<c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f]+c[k]:g+=-1<c[k].search(/<\?/)?i[f]+c[k]:-1<c[k].search(/xmlns\:/)||-1<c[k].search(/xmlns\=/)?i[f]+c[k]:c[k];return"\n"===g[0]?g.slice(1):g}var l="undefined"!=typeof window&&"undefined"!=typeof window.document,m="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,n="object"===("undefined"==typeof self?"undefined":a(self))&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,o=function(){var a={};if(m){var b=require("xmldom"),c=b.DOMParser,d=b.XMLSerializer;a.DOMParser=c,a.XMLSerializer=d,a.document=new c().parseFromString("<!DOCTYPE html><title> </title>","text/html")}else l&&(a=window);return a}(),q="http://www.w3.org/2000/svg",r=function(){var a=o.document.createElementNS(q,"svg");return a.setAttribute("version","1.1"),a.setAttribute("xmlns",q),a},s=function(){var a=o.document.createElementNS(q,"g");return a},t=function(a,b,c,e,f){var g=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,h=e/1-e,d=[b-h-g,c-h-g,e+2*h+2*g,f+2*h+2*g].join(" ");a.setAttributeNS(null,"viewBox",d)},u=function(a,b,c,d){var e=o.document.createElementNS(q,"line");return e.setAttributeNS(null,"x1",a),e.setAttributeNS(null,"y1",b),e.setAttributeNS(null,"x2",c),e.setAttributeNS(null,"y2",d),e},w=function(a,b,c){var d=o.document.createElementNS(q,"circle");return d.setAttributeNS(null,"cx",a),d.setAttributeNS(null,"cy",b),d.setAttributeNS(null,"r",c),d},x=function(a){var b=o.document.createElementNS(q,"polygon"),c=a.reduce(function(c,a){return"".concat(c).concat(a[0],",").concat(a[1]," ")},"");return b.setAttributeNS(null,"points",c),b},y=function(a){var b=o.document.createElementNS(q,"path");return b.setAttributeNS(null,"d",a),b},z=function(a,b,c,d,e,f,g,h){var i=[[a,b],[c,d],[e,f],[g,h]].map(function(a){return a.join(",")});return y("M ".concat(i[0]," C ").concat(i[1]," ").concat(i[2]," ").concat(i[3]))},A=function(b,c,d){var e=Math.sqrt,f={color:"#000",strokeWidth:.5,width:.5,length:2,bend:.3,pinch:.618,padding:.5,side:!0,start:!1,end:!0,strokeStyle:"",fillStyle:""};"object"===a(d)&&null!==d&&Object.assign(f,d);var g=["stroke:none","fill:".concat(f.color),f.fillStyle].filter(function(b){return""!==b}).join(";"),h=["fill:none","stroke:".concat(f.color),"stroke-width:".concat(f.strokeWidth),f.strokeStyle].filter(function(b){return""!==b}).join(";"),i=b,j=c,k=[j[0]-i[0],j[1]-i[1]],l=[i[0]+k[0]/2,i[1]+k[1]/2],m=e(k[0]*k[0]+k[1]*k[1]),n=2.5*((f.start?1+f.padding:0+f.end?1+f.padding:0)*f.length);if(m<n){var p=[k[0]/m*n,k[1]/m*n];i=[l[0]-.5*p[0],l[1]-.5*p[1]],j=[l[0]+.5*p[0],l[1]+.5*p[1]],k=[j[0]-i[0],j[1]-i[1]]}var r=[k[1],-k[0]],s=[l[0]+r[0]*(f.side?1:-1)*f.bend,l[1]+r[1]*(f.side?1:-1)*f.bend],t=[s[0]-i[0],s[1]-i[1]],u=[s[0]-j[0],s[1]-j[1]],v=e(t[0]*t[0]+t[1]*t[1]),w=e(u[0]*u[0]+u[1]*u[1]),y=[t[0]/v,t[1]/v],A=[u[0]/w,u[1]/w],B=[-y[0],-y[1]],C=[-A[0],-A[1]],D=[B[1],-B[0]],E=[C[1],-C[0]],F=[i[0]+y[0]*f.length*((f.start?1:0)+f.padding),i[1]+y[1]*f.length*((f.start?1:0)+f.padding)],G=[j[0]+A[0]*f.length*((f.end?1:0)+f.padding),j[1]+A[1]*f.length*((f.end?1:0)+f.padding)];k=[G[0]-F[0],G[1]-F[1]],r=[k[1],-k[0]],l=[F[0]+k[0]/2,F[1]+k[1]/2],s=[l[0]+r[0]*(f.side?1:-1)*f.bend,l[1]+r[1]*(f.side?1:-1)*f.bend];var H=[F[0]+(s[0]-F[0])*f.pinch,F[1]+(s[1]-F[1])*f.pinch],I=[G[0]+(s[0]-G[0])*f.pinch,G[1]+(s[1]-G[1])*f.pinch],J=[[F[0]+D[0]*-f.width,F[1]+D[1]*-f.width],[F[0]+D[0]*f.width,F[1]+D[1]*f.width],[F[0]+B[0]*f.length,F[1]+B[1]*f.length]],K=[[G[0]+E[0]*-f.width,G[1]+E[1]*-f.width],[G[0]+E[0]*f.width,G[1]+E[1]*f.width],[G[0]+C[0]*f.length,G[1]+C[1]*f.length]],L=o.document.createElementNS(q,"g"),M=z(F[0],F[1],H[0],H[1],I[0],I[1],G[0],G[1]);if(M.setAttribute("style",h),L.appendChild(M),f.start){var N=x(J);N.setAttribute("style",g),L.appendChild(N)}if(f.end){var O=x(K);O.setAttribute("style",g),L.appendChild(O)}return L},B=/*#__PURE__*/Object.freeze({__proto__:null,svg:r,group:s,style:function(){var a=o.document.createElementNS(q,"style");return a.setAttribute("type","text/css"),a},setViewBox:t,line:u,circle:w,polygon:x,path:y,bezier:z,arcArrow:A}),C=function(a,b){if(!1=="vertices_coords"in a)return[];var c=b&&b.radius?b.radius:.01,d=a.vertices_coords.map(function(a){return w(a[0],a[1],c)});return d.forEach(function(a,b){return a.setAttribute("id","".concat(b))}),d},D={B:"boundary",b:"boundary",M:"mountain",m:"mountain",V:"valley",v:"valley",F:"mark",f:"mark",U:"unassigned",u:"unassigned"},E={B:"b",b:"b",M:"m",m:"m",V:"v",v:"v",F:"f",f:"f",U:"u",u:"u"},F=function(a){var b=a.vertices_coords,c=a.edges_vertices;return null==c||null==b?[]:c.map(function(a){return a.map(function(a){return b[a]})})},G=function(a){var b=a.edges_assignment,c={b:[],m:[],v:[],f:[],u:[]};return b.map(function(b){return E[b]}).forEach(function(b,a){return c[b].push(a)}),c},H=function(a){return null==a.edges_vertices||null==a.edges_assignment||a.edges_vertices.length!==a.edges_assignment.length?[]:a.edges_assignment.map(function(b){return D[b]})},I=function(a){return"M".concat(a[0][0]," ").concat(a[0][1],"L").concat(a[1][0]," ").concat(a[1][1])},J=function(a){return F(a).map(function(a){return I(a)}).join("")},K=function(a){if(null==a.edges_vertices||null==a.vertices_coords||null==a.edges_assignment)return[];var b=F(a),c=G(a),d=Object.keys(c).map(function(a){return c[a].map(function(a){return b[a]})}).map(function(a){return a.map(function(a){return I(a)}).join("")}),e={};return Object.keys(c).map(function(a,b){""!==d[b]&&(e[a]=d[b])}),e},L=function(a){if(null==a.edges_assignment)return[y(J(a))];var b=K(a);return Object.keys(b).map(function(a){var c=y(b[a]);return c.setAttributeNS(null,"class",D[a]),c})},M=function(a){var b=a.edges_vertices;if(b){var c=[];return b.forEach(function(a,b){return a.forEach(function(a){void 0===c[a]&&(c[a]=[]),c[a].push(b)})}),c}},N=function(a){var b=a.faces_vertices;if(b){var c=b.length,d=Array.from(Array(c)).map(function(){return[]}),e={};return b.forEach(function(a,b){if(void 0!==a){var c=a.length;a.forEach(function(a,f,g){var h=g[(f+1)%c];if(h<a){var i=[h,a];a=i[0],h=i[1]}var j="".concat(a," ").concat(h);if(j in e){var k=e[j];d[b].push(k),d[k].push(b)}else e[j]=b})}}),d}},O=function(a){var b=a.edges_vertices;if(!b)return{};var c={};return b.map(function(a){return a.sort(function(c,a){return c-a}).join(" ")}).forEach(function(a,b){c[a]=b}),c},P=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=O(a),d=N(a);if(0>=d.length)return[];var e=[b],f=[[{face:b,parent:void 0,edge:void 0,level:0}]];do f[f.length]=f[f.length-1].map(function(b){var f=d[b.face].filter(function(a){return-1===e.indexOf(a)});return e=e.concat(f),f.map(function(d){var e=a.faces_vertices[d].filter(function(c){return-1!==a.faces_vertices[b.face].indexOf(c)}).sort(function(c,a){return c-a}),f=c[e.join(" ")];return{face:d,parent:b.face,edge:f,edge_vertices:e}})}).reduce(function(a,b){return a.concat(b)},[]);while(0<f[f.length-1].length);return 0<f.length&&0===f[f.length-1].length&&f.pop(),f},Q=function(a){return a.map(function(a){return a[0]*a[3]-a[1]*a[2]}).map(function(a){return 0<=a})},R=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=[];return c[b]=!0,P(a,b).forEach(function(a,b){return a.forEach(function(a){c[a.face]=0==b%2})}),c},S=function(a){return a.map(function(a,b){return{layer:a,i:b}}).sort(function(c,a){return c.layer-a.layer}).map(function(a){return a.i})},T=function(a){var b=a["faces_re:coloring"];return null==b&&(b="faces_re:matrix"in a?Q(a["faces_re:matrix"]):R(a,0)),b.map(function(a){return a?"front":"back"})},U=function(a,b){var c=null!=a["faces_re:layer"]&&a["faces_re:layer"].length===a.faces_vertices.length;return c&&T(a).forEach(function(a,c){return b[c].setAttribute("class",a)}),c?S(a["faces_re:layer"]).map(function(a){return b[a]}):b},V=function(a){if(!1=="faces_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.faces_vertices.map(function(b){return b.map(function(b){return a.vertices_coords[b]})}).map(function(a){return x(a)});return b.forEach(function(a,b){return a.setAttribute("index",b)}),U(a,b)},W=function(a){if(!1=="faces_edges"in a||!1=="edges_vertices"in a||!1=="vertices_coords"in a)return[];var b=a.faces_edges.map(function(b){return b.map(function(b){return a.edges_vertices[b]}).map(function(a,b,c){var d=c[(b+1)%c.length];return a[1]===d[0]||a[1]===d[1]?a[0]:a[1]}).map(function(b){return a.vertices_coords[b]})}).map(function(a){return x(a)});return b.forEach(function(a,b){return a.setAttribute("index",b)}),U(a,b)},X=function(a){var b=a.vertices_coords;if(null==b||0>=b.length)return[0,0,0,0];var c=b[0].length,d=Array(c).fill(1/0),e=Array(c).fill(-Infinity);return b.forEach(function(a){return a.forEach(function(a,b){a<d[b]&&(d[b]=a),a>e[b]&&(e[b]=a)})}),isNaN(d[0])||isNaN(d[1])||isNaN(e[0])||isNaN(e[1])?[0,0,0,0]:[d[0],d[1],e[0]-d[0],e[1]-d[1]]},Y=function(a){if(null==a.edges_assignment)return{vertices:[],edges:[]};for(var c=a.edges_assignment.map(function(b){return"B"===b||"b"===b}),d=M(a),e=[],f=[],g=-1,h=0;h<c.length;h+=1)if(c[h]){g=h;break}if(-1===g)return{vertices:[],edges:[]};c[g]=!1,e.push(g),f.push(a.edges_vertices[g][0]);for(var j=a.edges_vertices[g][1];f[0]!==j;){if(f.push(j),g=d[j].filter(function(a){return c[a]}).shift(),void 0===g)return{vertices:[],edges:[]};if(a.edges_vertices[g][0]===j){var k=b(a.edges_vertices[g],2);j=k[1]}else{var l=b(a.edges_vertices[g],1);j=l[0]}c[g]=!1,e.push(g)}return{vertices:f,edges:e}},Z=function b(c){var d,e;if("object"!==a(c))return c;if(!c)return c;if("[object Array]"===Object.prototype.toString.apply(c)){for(d=[],e=0;e<c.length;e+=1)d[e]=b(c[e]);return d}for(e in d={},c)c.hasOwnProperty(e)&&(d[e]=b(c[e]));return d},$=function(a,b){if(!1=="file_frames"in a||a.file_frames.length<b)return a;var c=["frame_parent","frame_inherit"],d={visited_frames:[]};return function a(b,c,e){if(-1!==d.visited_frames.indexOf(c))throw new Error("encountered a cycle in file_frames. can't flatten.");return d.visited_frames.push(c),e=[c].concat(e),0===c?e:b.file_frames[c-1].frame_inherit&&null!=b.file_frames[c-1].frame_parent?a(b,b.file_frames[c-1].frame_parent,e):e}(a,b,[]).map(function(b){if(0===b){var d=a.file_frames;a.file_frames=null;var e=Z(a);return a.file_frames=d,delete e.file_frames,c.forEach(function(a){return delete e[a]}),e}var f=Z(a.file_frames[b-1]);return c.forEach(function(a){return delete f[a]}),f}).reduce(function(a,b){return Object.assign(a,b)},{})},_=function(a){var b=(null==a.file_classes?[]:a.file_classes).join(" "),c=(null==a.frame_classes?[]:a.frame_classes).join(" ");return[b,c].filter(function(a){return""!==a}).join(" ")},aa=o.document,ba=function(a){if(!1=="vertices_coords"in a||!1=="edges_vertices"in a||!1=="edges_assignment"in a)return[];var b=Y(a).vertices.map(function(b){return a.vertices_coords[b]}),c=x(b);return c.setAttribute("class","boundary"),[c]},ca={vertices:C,edges:L,faces:function(a){return null==a.faces_vertices?W(a):V(a)},boundaries:ba},da=Object.freeze({input:"string",output:"string",padding:null,viewBox:null,file_frame:null,diagrams:!0,boundaries:!0,faces:!0,edges:!0,vertices:!1}),ea=function(a){return"string"==typeof a||a instanceof String?JSON.parse(a):a},fa=Object.freeze({width:"500px",height:"500px",stroke:"black",fill:"none","stroke-linejoin":"bevel"}),ga=Object.freeze({boundaries:{},faces:{stroke:"none"},edges:{},vertices:{stroke:"none",fill:"black"}}),ha=Object.freeze({front:{stroke:"black",fill:"gray"},back:{stroke:"black",fill:"white"}}),ia=Object.freeze({boundary:{},mountain:{stroke:"red"},valley:{stroke:"blue"},mark:{stroke:"gray"},unassigned:{}}),ja=function(b){var d=Math.min,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:da;Object.keys(da).filter(function(a){return!(a in e)}).forEach(function(a){e[a]=da[a]});var f="number"==typeof e.file_frame?$(ea(b),e.file_frame):ea(b),g=r();Object.keys(fa).forEach(function(a){return g.setAttribute(a,fa[a])}),"number"!=typeof parseFloat(e.width)||isNaN(parseFloat(e.width))||g.setAttribute("width",e.width),"number"!=typeof parseFloat(e.height)||isNaN(parseFloat(e.height))||g.setAttribute("height",e.height);var h=_(f);""!==h&&g.setAttribute("class",h);var i={};["boundaries","edges","faces","vertices"].filter(function(a){return!0===e[a]}).forEach(function(a){i[a]=s(),i[a].setAttribute("class",a),Object.keys(ga[a]).forEach(function(b){return i[a].setAttribute(b,ga[a][b])})}),Object.keys(i).forEach(function(b){return ca[b](f).forEach(function(c){return i[b].appendChild(c)})}),Object.keys(i).filter(function(a){return 0<i[a].childNodes.length}).forEach(function(a){return g.appendChild(i[a])}),Object.keys(ia).forEach(function(a){return Array.from(i.edges.childNodes).filter(function(b){return a===b.getAttribute("class")}).forEach(function(b){return Object.keys(ia[a]).forEach(function(c){return b.setAttribute(c,ia[a][c])})})}),Object.keys(ha).forEach(function(a){return Array.from(i.faces.childNodes).filter(function(b){return a===b.getAttribute("class")}).forEach(function(b){return Object.keys(ha[a]).forEach(function(c){return b.setAttribute(c,ha[a][c])})})});var j=X(f);null!==e.viewBox&&("string"==typeof e.viewBox||"object"===a(e.viewBox))?t.apply(B,[g].concat(c(e.viewBox),[e.padding])):t.apply(B,[g].concat(c(j),[e.padding]));var l=d(j[2],j[3]);if(0!==l&&g.setAttribute("stroke-width",l/100),"svg"===e.output)return g;var m=new o.XMLSerializer().serializeToString(g),n=k(m);return n},ka=function(b){if(null==b)return{};if("object"===a(b)&&null!==b)return b;if("string"==typeof b||b instanceof String)try{var c=JSON.parse(b);return c}catch(a){throw a}throw new TypeError("couldn't recognize input. looking for string or object")},la=function(a,b){try{var c=ka(a);return ja(c,b)}catch(a){throw a}};return la.vertices_circle=C,la.edges_path_data=J,la.edges_by_assignment_paths_data=K,la.edges_path=L,la.edges_line=function(a){var b=F(a).map(function(a){return u(a[0][0],a[0][1],a[1][0],a[1][1])});return b.forEach(function(a,b){return a.setAttributeNS(null,"index",b)}),H(a).forEach(function(c,a){return b[a].setAttributeNS(null,"class",c)}),b},la.faces_vertices_polygon=V,la.faces_edges_polygon=W,la});
