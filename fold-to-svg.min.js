/* (c) Robby Kraft, MIT License */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.FoldToSvg=b())})(this,function(){'use strict';function a(b){"@babel/helpers - typeof";return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){return e(a)||h(a,b)||j()}function c(a){return d(a)||f(a)||i()}function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function e(a){if(Array.isArray(a))return a}function f(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function h(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function k(a,b){for(var c=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),d=c.length,e=!1,f=0,g="",h=null!=b&&"string"==typeof b?b:"\t",i=["\n"],j=0;100>j;j+=1)i.push(i[j]+h);for(var k=0;k<d;k+=1)-1<c[k].search(/<!/)?(g+=i[f]+c[k],e=!0,(-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)||-1<c[k].search(/!DOCTYPE/))&&(e=!1)):-1<c[k].search(/-->/)||-1<c[k].search(/\]>/)?(g+=c[k],e=!1):/^<\w/.exec(c[k-1])&&/^<\/\w/.exec(c[k])&&/^<[\w:\-\.\,]+/.exec(c[k-1])==/^<\/[\w:\-\.\,]+/.exec(c[k])[0].replace("/","")?(g+=c[k],e||(f-=1)):-1<c[k].search(/<\w/)&&-1===c[k].search(/<\//)&&-1===c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f++]+c[k]:-1<c[k].search(/<\w/)&&-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[f]+c[k]:-1<c[k].search(/<\//)?g=e?g+=c[k]:g+=i[--f]+c[k]:-1<c[k].search(/\/>/)?g=e?g+=c[k]:g+=i[f]+c[k]:g+=-1<c[k].search(/<\?/)?i[f]+c[k]:-1<c[k].search(/xmlns\:/)||-1<c[k].search(/xmlns\=/)?i[f]+c[k]:c[k];return"\n"===g[0]?g.slice(1):g}var l="vertices",m="edges",n="faces",o="frame",p="file",q="".concat(l,"_").concat("coords"),r="".concat(m,"_").concat(l),s="".concat(n,"_").concat(l),t="".concat(n,"_").concat(m),u="".concat(m,"_assignment"),v="".concat(n,"_re:coloring"),w="".concat(n,"_re:matrix"),x="".concat(n,"_re:layer"),y="".concat(o,"_parent"),z="".concat(o,"_inherit"),A="".concat(o,"_classes"),B="".concat(p,"_frames"),C="".concat(p,"_classes"),D="boundary",E="mountain",F="valley",G="mark",H="unassigned",I="front",J="back",K="class",L="index",M="object",N="string",O="undefined",P="black",Q="white",R="lightgray",S="stroke-width",T="createElementNS",U="setAttributeNS",V="appendChild",W=("undefined"==typeof window?"undefined":a(window))!==O&&a(window.document)!==O,X=("undefined"==typeof process?"undefined":a(process))!==O&&null!=process.versions&&null!=process.versions.node,Y=("undefined"==typeof self?"undefined":a(self))===M&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,Z=function(){var a={};if(X){var b=require("xmldom"),c=b.DOMParser,d=b.XMLSerializer;a.DOMParser=c,a.XMLSerializer=d,a.document=new c().parseFromString("<!DOCTYPE html><title>.</title>","text/html")}else W&&(a=window);return a}(),$="http://www.w3.org/2000/svg",_=function(){var a=Z.document[T]($,"svg");return a.setAttribute("version","1.1"),a.setAttribute("xmlns",$),a},aa=function a(b){var a=Z.document[T]($,"g");return b&&b[V](a),a},g=function a(b){var a=Z.document[T]($,"defs");return b&&b[V](a),a},ba=function(a){var b=Z.document[T]($,"style");return b[U](null,"type","text/css"),a&&a[V](b),b},ca=function(a,b,c,e,f){var g=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,h=e/1-e,d=[b-h-g,c-h-g,e+2*h+2*g,f+2*h+2*g].join(" ");a[U](null,"viewBox",d)},da=function(a,b,c,d){var e=Z.document[T]($,"line");return e[U](null,"x1",a),e[U](null,"y1",b),e[U](null,"x2",c),e[U](null,"y2",d),e},ea=function(a,b,c){var d=Z.document[T]($,"circle");return d[U](null,"cx",a),d[U](null,"cy",b),d[U](null,"r",c),d},fa=function(a){var b=Z.document[T]($,"polygon"),c=a.map(function(a){return"".concat(a[0],",").concat(a[1])}).join(" ");return b[U](null,"points",c),b},ga=function(a){var b=Z.document[T]($,"path");return b[U](null,"d",a),b},ha=/*#__PURE__*/Object.freeze({__proto__:null,svgNS:$,svg:_,g:aa,defs:g,style:ba,setViewBox:ca,line:da,circle:ea,polygon:fa,path:ga}),ia=function(a,b){if(!1==q in a)return[];var c=b&&b.radius?b.radius:.01,d=a[q].map(function(a){return ea(a[0],a[1],c)});return d.forEach(function(a,b){return a[U](null,L,b)}),d},ja={B:D,b:D,M:E,m:E,V:F,v:F,F:G,f:G,U:H,u:H},ka={B:"b",b:"b",M:"m",m:"m",V:"v",v:"v",F:"f",f:"f",U:"u",u:"u"},la=function(a){var b=a.vertices_coords,c=a.edges_vertices;return null==c||null==b?[]:c.map(function(a){return a.map(function(a){return b[a]})})},ma=function(a){var b={u:[],f:[],v:[],m:[],b:[]};return a[u].map(function(b){return ka[b]}).forEach(function(c,a){return b[c].push(a)}),b},na=function(a){return null==a[r]||null==a[u]||a[r].length!==a[u].length?[]:a[u].map(function(b){return ja[b]})},oa=function(a){return"M".concat(a[0][0]," ").concat(a[0][1],"L").concat(a[1][0]," ").concat(a[1][1])},pa=function(a){var b=la(a).map(function(a){return oa(a)}).join("");return""===b?void 0:b},qa=function(a){if(null==a[r]||null==a[q]||null==a[u])return[];var b=la(a),c=ma(a),d=Object.keys(c).map(function(a){return c[a].map(function(a){return b[a]})}).map(function(a){return a.map(function(a){return oa(a)}).join("")}),e={};return Object.keys(c).map(function(a,b){""!==d[b]&&(e[a]=d[b])}),e},ra=function(a){if(null==a[u]){var b=pa(a);return void 0===b?[]:[ga(b)]}var c=qa(a);return Object.keys(c).map(function(a){var b=ga(c[a]);return b[U](null,K,ja[a]),b})},sa=function(a){var b=a.edges_vertices;if(b){var c=[];return b.forEach(function(a,b){return a.forEach(function(a){void 0===c[a]&&(c[a]=[]),c[a].push(b)})}),c}},ta=function(a){var b=a.faces_vertices;if(b){var c=b.length,d=Array.from(Array(c)).map(function(){return[]}),e={};return b.forEach(function(a,b){if(void 0!==a){var c=a.length;a.forEach(function(a,f,g){var h=g[(f+1)%c];if(h<a){var i=[h,a];a=i[0],h=i[1]}var j="".concat(a," ").concat(h);if(j in e){var k=e[j];d[b].push(k),d[k].push(b)}else e[j]=b})}}),d}},ua=function(a){var b=a.edges_vertices;if(!b)return{};var c={};return b.map(function(a){return a.sort(function(c,a){return c-a}).join(" ")}).forEach(function(a,b){c[a]=b}),c},va=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=ua(a),d=ta(a);if(0>=d.length)return[];var e=[b],f=[[{face:b,parent:void 0,edge:void 0,level:0}]];do f[f.length]=f[f.length-1].map(function(b){var f=d[b.face].filter(function(a){return-1===e.indexOf(a)});return e=e.concat(f),f.map(function(d){var e=a.faces_vertices[d].filter(function(c){return-1!==a.faces_vertices[b.face].indexOf(c)}).sort(function(c,a){return c-a}),f=c[e.join(" ")];return{face:d,parent:b.face,edge:f,edge_vertices:e}})}).reduce(function(a,b){return a.concat(b)},[]);while(0<f[f.length-1].length);return 0<f.length&&0===f[f.length-1].length&&f.pop(),f},wa=function(a){return a.map(function(a){return a[0]*a[3]-a[1]*a[2]}).map(function(a){return 0<=a})},xa=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=[];return c[b]=!0,va(a,b).forEach(function(a,b){return a.forEach(function(a){c[a.face]=0==b%2})}),c},ya=function(a){return a.map(function(a,b){return{layer:a,i:b}}).sort(function(c,a){return c.layer-a.layer}).map(function(a){return a.i})},za=function(a){var b=a[v];return null==b&&(b=w in a?wa(a[w]):xa(a,0)),b.map(function(a){return a?I:J})},Aa=function(b,c){var d=a(b.frame_classes)===M&&null!==b.frame_classes&&!b.frame_classes.includes("creasePattern"),e=null!=b[x]&&b[x].length===b[s].length;return e&&d&&za(b).forEach(function(a,b){return c[b][U](null,K,a)}),e?ya(b[x]).map(function(a){return c[a]}):c},Ba=function(a){if(!1==s in a||!1==q in a)return[];var b=a[s].map(function(b){return b.map(function(b){return a[q][b]})}).map(function(a){return fa(a)});return b.forEach(function(a,b){return a[U](null,L,b)}),Aa(a,b)},Ca=function(a){if(!1==t in a||!1==r in a||!1==q in a)return[];var b=a[t].map(function(b){return b.map(function(b){return a[r][b]}).map(function(a,b,c){var d=c[(b+1)%c.length];return a[1]===d[0]||a[1]===d[1]?a[0]:a[1]}).map(function(b){return a[q][b]})}).map(function(a){return fa(a)});return b.forEach(function(a,b){return a[U](null,L,b)}),Aa(a,b)},Da=function(a,b){var c=function(){return a.apply(void 0,[this].concat(Array.prototype.slice.call(arguments)))};b.__prototypes__.cp.svg=c,b.__prototypes__.graph.svg=c},Ea=function(a){if(null==a[q]||0>=a[q].length)return[0,0,0,0];var b=a[q][0].length,c=Array(b).fill(1/0),d=Array(b).fill(-Infinity);return a[q].forEach(function(a){return a.forEach(function(a,b){a<c[b]&&(c[b]=a),a>d[b]&&(d[b]=a)})}),isNaN(c[0])||isNaN(c[1])||isNaN(d[0])||isNaN(d[1])?[0,0,0,0]:[c[0],c[1],d[0]-c[0],d[1]-c[1]]},Fa=function(a){if(null==a[u])return{vertices:[],edges:[]};for(var c=a[u].map(function(b){return"B"===b||"b"===b}),d=sa(a),e=[],f=[],g=-1,h=0;h<c.length;h+=1)if(c[h]){g=h;break}if(-1===g)return{vertices:[],edges:[]};c[g]=!1,e.push(g),f.push(a[r][g][0]);for(var j=a[r][g][1];f[0]!==j;){if(f.push(j),g=d[j].filter(function(a){return c[a]}).shift(),void 0===g)return{vertices:[],edges:[]};if(a[r][g][0]===j){var k=b(a[r][g],2);j=k[1]}else{var l=b(a[r][g],1);j=l[0]}c[g]=!1,e.push(g)}return{vertices:f,edges:e}},Ga=function b(c){var d,e;if(a(c)!==M)return c;if(!c)return c;if("[object Array]"===Object.prototype.toString.apply(c)){for(d=[],e=0;e<c.length;e+=1)d[e]=b(c[e]);return d}for(e in d={},c)c.hasOwnProperty(e)&&(d[e]=b(c[e]));return d},Ha=function b(c){return(Object.freeze(c),void 0===c)?c:(Object.getOwnPropertyNames(c).filter(function(b){return null!==c[b]&&(a(c[b])===M||a(c[b])==="function")&&!Object.isFrozen(c[b])}).forEach(function(a){return b(c[a])}),c)},Ia=function(a,b){if(!1==B in a||a[B].length<b)return a;var c=[y,z],d={visited_frames:[]};return function a(b,c,e){if(-1!==d.visited_frames.indexOf(c))throw new Error("flatten error:cycle");return d.visited_frames.push(c),e=[c].concat(e),0===c?e:b[B][c-1].frame_inherit&&null!=b[B][c-1].frame_parent?a(b,b[B][c-1].frame_parent,e):e}(a,b,[]).map(function(b){if(0===b){var d=a[B];a[B]=null;var e=Ga(a);return a[B]=d,delete e[B],c.forEach(function(a){return delete e[a]}),e}var f=Ga(a[B][b-1]);return c.forEach(function(a){return delete f[a]}),f}).reduce(function(a,b){return Object.assign(a,b)},{})},Ja=function(a){var b=(null==a[C]?[]:a[C]).join(" "),c=(null==a[A]?[]:a[A]).join(" ");return[b,c].filter(function(a){return""!==a}).join(" ")},Ka=Z.document,La=Object.freeze({blur:.005,opacity:.3,color:P}),Ma="result",Na="in",Oa="blur",Pa="offsetColor",Qa="offsetBlur",Ra="feMergeNode",Sa="200%",Ta=function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:La;(a(b)!==M||null===b)&&(b={}),Object.keys(La).filter(function(a){return!(a in b)}).forEach(function(a){b[a]=La[a]});var c=Ka[T]($,"filter");c[U](null,"width",Sa),c[U](null,"height",Sa),c[U](null,"id","shadow");var d=Ka[T]($,"feGaussianBlur");d[U](null,Na,"SourceAlpha"),d[U](null,"stdDeviation",b.blur),d[U](null,Ma,Oa);var e=Ka[T]($,"feOffset");e[U](null,Na,Oa),e[U](null,Ma,Qa);var f=Ka[T]($,"feFlood");f[U](null,"flood-color",b.color),f[U](null,"flood-opacity",b.opacity),f[U](null,Ma,Pa);var g=Ka[T]($,"feComposite");g[U](null,Na,Pa),g[U](null,"in2",Qa),g[U](null,"operator",Na),g[U](null,Ma,Qa);var h=Ka[T]($,"feMerge"),i=Ka[T]($,Ra),j=Ka[T]($,Ra);return j[U](null,Na,"SourceGraphic"),h[V](i),h[V](j),c[V](d),c[V](e),c[V](f),c[V](g),c[V](h),c},Ua="none",Va="500px",Wa=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return Ha({input:N,output:N,padding:null,file_frame:null,stylesheet:null,shadows:null,boundaries:!0,faces:!0,edges:!0,vertices:!1,attributes:{svg:{width:Va,height:Va,stroke:P,fill:Ua,"stroke-linejoin":"bevel","stroke-width":a/200},boundaries:{fill:Q},faces:{stroke:Ua,front:{stroke:P,fill:R},back:{stroke:P,fill:Q}},edges:{boundary:{},mountain:{stroke:"red"},valley:{stroke:"blue"},mark:{stroke:R},unassigned:{stroke:R}},vertices:{stroke:Ua,fill:P,r:a/200}}})},Xa=function b(c,d){Object.keys(d).forEach(function(e){a(d[e])===M&&null!==d[e]?(!(e in c)&&(c[e]={}),b(c[e],d[e])):a(c)===M&&!(e in c)&&(c[e]=d[e])})},Ya=function(a){if(!1==q in a||!1==r in a||!1==u in a)return[];var b=Fa(a).vertices.map(function(b){return a[q][b]});if(0===b.length)return[];var c=fa(b);return c[U](null,K,D),[c]},Za={vertices:ia,edges:ra,faces:function(a){return null==a[s]?Ca(a):Ba(a)},boundaries:Ya},$a=function(b){var d=Math.min,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f="number"==typeof e.file_frame?Ia(b,e.file_frame):b,h=Ea(f),i=d(h[2],h[3]);Xa(e,Wa(i));var j=_();ca.apply(ha,[j].concat(c(h),[e.padding]));var o=Ja(f);""!==o&&j[U](null,K,o),Object.keys(e.attributes.svg).forEach(function(a){return j[U](null,a,e.attributes.svg[a])});var p=null!=e.stylesheet||null!=e.shadows?g(j):void 0;if(null!=e.stylesheet){var q=ba(p),r=e.attributes.svg[S]?e.attributes.svg[S]:i/200,s=new Z.DOMParser().parseFromString("<xml></xml>","application/xml").createCDATASection("\n* { --".concat(S,": ").concat(r,"; }\n").concat(e.stylesheet));q[V](s)}if(null!=e.shadows){var t=a(e.shadows)===M&&null!==e.shadows?e.shadows:{blur:i/200};p[V](Ta(t))}var u={};if(["boundaries",m,n,l].filter(function(a){return!0===e[a]}).forEach(function(a){u[a]=aa(),u[a][U](null,K,a)}),Object.keys(u).filter(function(a){return void 0!==Za[a]}).forEach(function(b){return Za[b](f,e).forEach(function(c){return u[b][V](c)})}),Object.keys(u).filter(function(a){return 0<u[a].childNodes.length}).forEach(function(a){return j[V](u[a])}),u.edges){var v=[H,G,F,E,D];Object.keys(e.attributes.edges).filter(function(a){return!v.includes(a)}).forEach(function(a){return u.edges[U](null,a,e.attributes.edges[a])}),Array.from(u.edges.childNodes).forEach(function(a){return Object.keys(e.attributes.edges[a.getAttribute(K)]||{}).forEach(function(b){return a[U](null,b,e.attributes.edges[a.getAttribute(K)][b])})})}if(u.faces){var w=[I,J];Object.keys(e.attributes.faces).filter(function(a){return!w.includes(a)}).forEach(function(a){return u.faces[U](null,a,e.attributes.faces[a])}),Array.from(u.faces.childNodes).forEach(function(a){return Object.keys(e.attributes.faces[a.getAttribute(K)]||{}).forEach(function(b){return a[U](null,b,e.attributes.faces[a.getAttribute(K)][b])})}),null!=e.shadows&&Array.from(u.faces.childNodes).forEach(function(a){return a[U](null,"filter","url(#shadow)")})}if(u.vertices&&(Object.keys(e.attributes.vertices).filter(function(a){return"r"!==a}).forEach(function(a){return u.vertices[U](null,a,e.attributes.vertices[a])}),Array.from(u.vertices.childNodes).forEach(function(a){return a[U](null,"r",e.attributes.vertices.r)})),u.boundaries&&Object.keys(e.attributes.boundaries).forEach(function(a){return u.boundaries[U](null,a,e.attributes.boundaries[a])}),"svg"===e.output)return j;var x=new Z.XMLSerializer().serializeToString(j),y=k(x);return y},_a=function(b){if(null==b)return{};if(a(b)===M&&null!==b)return b;if(a(b)===N||b instanceof String)try{var c=JSON.parse(b);return c}catch(a){throw a}throw new TypeError("input requires ".concat(N," or ").concat(M))},ab=function(a,b){try{var c=_a(a);return $a(c,b)}catch(a){throw a}};return ab.vertices_circle=ia,ab.edges_path_data=pa,ab.edges_by_assignment_paths_data=qa,ab.edges_path=ra,ab.edges_line=function(a){var b=la(a).map(function(a){return da(a[0][0],a[0][1],a[1][0],a[1][1])});return b.forEach(function(a,b){return a[U](null,L,b)}),na(a).forEach(function(c,a){return b[a][U](null,K,c)}),b},ab.faces_vertices_polygon=Ba,ab.faces_edges_polygon=Ca,ab.append=function(a){"function"==typeof a.cp&&"function"==typeof a.graph&&"function"==typeof a.origami&&Da(this,a)}.bind(ab),ab});
